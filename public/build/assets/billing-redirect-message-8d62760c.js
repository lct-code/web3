import{bx as B,bw as F,r as o,b7 as W,u as z,Y as R,j as s,c as V,B as T,J as u,A as q,n as k,M as A,au as G,cu as U,T as L,a4 as X}from"./main-96dd97cc.js";import{T as J}from"./TaskAlt-43ef6839.js";var _="https://js.stripe.com/v3",O=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,P="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Y=function(){for(var e=document.querySelectorAll('script[src^="'.concat(_,'"]')),t=0;t<e.length;t++){var n=e[t];if(O.test(n.src))return n}return null},I=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(_).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n},H=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:t})},x=null,w=null,E=null,K=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},Q=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Z=function(e){return x!==null?x:(x=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(P),window.Stripe){t(window.Stripe);return}try{var a=Y();if(a&&e)console.warn(P);else if(!a)a=I(e);else if(a&&E!==null&&w!==null){var i;a.removeEventListener("load",E),a.removeEventListener("error",w),(i=a.parentNode)===null||i===void 0||i.removeChild(a),a=I(e)}E=Q(t,n),w=K(n),a.addEventListener("load",E),a.addEventListener("error",w)}catch(l){n(l);return}}),x.catch(function(t){return x=null,Promise.reject(t)}))},$=function(e,t,n){if(e===null)return null;var a=e.apply(void 0,t);return H(a,n),a},S,C=!1,M=function(){return S||(S=Z(null).catch(function(e){return S=null,Promise.reject(e)}),S)};Promise.resolve().then(function(){return M()}).catch(function(r){C||console.warn(r)});var ee=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];C=!0;var a=Date.now();return M().then(function(i){return $(i,t,a)})};function te({type:r,productId:e,priceId:t}){const{user:n}=B(),a=F(),i=o.useRef(!1),l=o.useRef(null),{localeCode:h}=W(),[d,j]=o.useState(null),[y,b]=o.useState(null),{branding:{site_name:m},billing:{stripe_public_key:c,stripe:{enable:p}}}=z();return o.useEffect(()=>{!p||!c||i.current||(Promise.all([ee(c,{apiVersion:"2022-08-01",locale:h}),r==="setupIntent"?re():ne(e,t)]).then(([f,{clientSecret:g}])=>{if(f&&l.current){const v=f.elements({clientSecret:g,appearance:{theme:a?"night":"stripe"}});v.create("payment",{business:{name:m},terms:{card:"never"},fields:{billingDetails:{address:"auto"}},defaultValues:{billingDetails:{email:n==null?void 0:n.email}}}).mount(l.current),j(f),b(v)}}),i.current=!0)},[e,c,p,a,h,m,r,n==null?void 0:n.email]),{stripe:d,elements:y,paymentElementRef:l,stripeIsEnabled:c!=null&&p}}function re(){return R.post("billing/stripe/create-setup-intent").then(r=>r.data)}function ne(r,e){return R.post("billing/stripe/create-partial-subscription",{product_id:r,price_id:e}).then(t=>t.data)}function oe({productId:r,priceId:e,type:t="subscription",submitLabel:n,returnUrl:a}){const{stripe:i,elements:l,paymentElementRef:h,stripeIsEnabled:d}=te({type:t,productId:r,priceId:e}),[j,y]=o.useState(null),[b,m]=o.useState(!1),c=!d||l!=null&&i!=null,p=async f=>{var g,v;if(f.preventDefault(),!(!i||!l)){m(!0);try{const N=await i[t==="subscription"?"confirmPayment":"confirmSetup"]({elements:l,confirmParams:{return_url:a}});((g=N.error)==null?void 0:g.type)!=="validation_error"&&((v=N.error)!=null&&v.message)&&y(N.error.message)}catch{}m(!1)}};return s.jsxs("form",{onSubmit:p,children:[s.jsx("div",{ref:h,className:V("min-h-[303px]",!d&&"hidden"),children:d&&s.jsx(se,{})}),j&&!b&&s.jsx("div",{className:"mt-20 text-danger",children:j}),s.jsx(T,{variant:"flat",color:"primary",size:"md",className:"mt-40 w-full",type:"submit",disabled:b||!c,children:n})]})}function se(){return s.jsxs(o.Fragment,{children:[s.jsx(u,{className:"mb-20 h-30"}),s.jsx(u,{className:"mb-20 h-30"}),s.jsx(u,{className:"mb-20 h-30"}),s.jsx(u,{className:"h-30"})]})}function ue({config:r}){return s.jsx(q,{initial:!1,mode:"wait",children:s.jsx("div",{className:"mt-80",children:r?s.jsxs(k.div,{className:"text-center",...A,children:[r.status==="success"?s.jsx(J,{className:"text-positive text-6xl"}):r.status==="pending"?s.jsx("div",{className:"flex items-center justify-center flex-auto",children:s.jsx(G,{isIndeterminate:!0,"aria-label":"Waiting for server response..."})}):s.jsx(U,{className:"text-danger text-6xl"}),s.jsx("div",{className:"text-2xl font-semibold mt-30",children:s.jsx(L,{...r.message})}),s.jsx(T,{variant:"flat",color:"primary",className:"w-full mt-30",size:"md",elementType:X,to:r.link,children:s.jsx(L,{...r.buttonLabel})})]},"payment-status"):s.jsx(ae,{},"loading-skeleton")})})}function ae(){return s.jsxs(k.div,{className:"text-center max-w-280",...A,children:[s.jsx(u,{size:"w-50 h-50",variant:"rect"}),s.jsx(u,{className:"text-2xl mt-30"}),s.jsx(u,{size:"h-42",className:"mt-30"})]},"loading-skeleton")}export{ue as B,oe as S,ee as l};
//# sourceMappingURL=billing-redirect-message-8d62760c.js.map
