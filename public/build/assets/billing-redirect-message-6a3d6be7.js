import{bl as _,bk as A,r as l,b6 as C,u as M,Y as y,j as t,c as B,B as N,L as o,A as D,o as I,ab as R,ar as F,cp as W,T as w,a1 as z}from"./main-48a583fc.js";import{T as V}from"./TaskAlt-ddc36365.js";var P="https://js.stripe.com/v3",q=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,E="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",G=function(){for(var e=document.querySelectorAll('script[src^="'.concat(P,'"]')),r=0;r<e.length;r++){var s=e[r];if(q.test(s.src))return s}return null},U=function(e){var r=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",s=document.createElement("script");s.src="".concat(P).concat(r);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(s),s},X=function(e,r){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"1.49.0",startTime:r})},b=null,$=function(e){return b!==null||(b=new Promise(function(r,s){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe&&e&&console.warn(E),window.Stripe){r(window.Stripe);return}try{var a=G();a&&e?console.warn(E):a||(a=U(e)),a.addEventListener("load",function(){window.Stripe?r(window.Stripe):s(new Error("Stripe.js not available"))}),a.addEventListener("error",function(){s(new Error("Failed to load Stripe.js"))})}catch(i){s(i);return}})),b},O=function(e,r,s){if(e===null)return null;var a=e.apply(void 0,r);return X(a,s),a},L=Promise.resolve().then(function(){return $(null)}),k=!1;L.catch(function(n){k||console.warn(n)});var Y=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];k=!0;var a=Date.now();return L.then(function(i){return O(i,r,a)})};function H({type:n,productId:e}){const{user:r}=_(),s=A(),a=l.useRef(!1),i=l.useRef(null),{localeCode:x}=C(),[u,S]=l.useState(null),[j,v]=l.useState(null),{branding:{site_name:m},billing:{stripe_public_key:c,stripe:{enable:d}}}=M();return l.useEffect(()=>{!d||!c||a.current||(Promise.all([Y(c,{apiVersion:"2022-08-01",locale:x}),n==="setupIntent"?J():K(e)]).then(([p,{clientSecret:h}])=>{if(p&&i.current){const f=p.elements({clientSecret:h,appearance:{theme:s?"night":"stripe"}});f.create("payment",{business:{name:m},terms:{card:"never"},defaultValues:{billingDetails:{email:r==null?void 0:r.email}}}).mount(i.current),S(p),v(f)}}),a.current=!0)},[e,c,d,s,x,m,n,r==null?void 0:r.email]),{stripe:u,elements:j,paymentElementRef:i,stripeIsEnabled:c!=null&&d}}function J(){return y.post("billing/stripe/create-setup-intent").then(n=>n.data)}function K(n){return y.post("billing/stripe/create-partial-subscription",{product_id:n}).then(e=>e.data)}function re({productId:n,type:e="subscription",submitLabel:r,returnUrl:s}){const{stripe:a,elements:i,paymentElementRef:x,stripeIsEnabled:u}=H({type:e,productId:n}),[S,j]=l.useState(null),[v,m]=l.useState(!1),c=!u||i!=null&&a!=null,d=async p=>{var h,f;if(p.preventDefault(),!(!a||!i)){m(!0);try{const g=await a[e==="subscription"?"confirmPayment":"confirmSetup"]({elements:i,confirmParams:{return_url:s}});((h=g.error)==null?void 0:h.type)!=="validation_error"&&((f=g.error)!=null&&f.message)&&j(g.error.message)}catch{}m(!1)}};return t.jsxs("form",{onSubmit:d,children:[t.jsx("div",{ref:x,className:B("min-h-[303px]",!u&&"hidden"),children:u&&t.jsx(Q,{})}),S&&!v&&t.jsx("div",{className:"text-danger mt-20",children:S}),t.jsx(N,{variant:"flat",color:"primary",size:"md",className:"w-full mt-40",type:"submit",disabled:v||!c,children:r})]})}function Q(){return t.jsxs(l.Fragment,{children:[t.jsx(o,{className:"h-30 mb-20"}),t.jsx(o,{className:"h-30 mb-20"}),t.jsx(o,{className:"h-30 mb-20"}),t.jsx(o,{className:"h-30"})]})}function ne({config:n}){return t.jsx(D,{initial:!1,mode:"wait",children:t.jsx("div",{className:"mt-80",children:n?t.jsxs(I.div,{className:"text-center",...R,children:[n.status==="success"?t.jsx(V,{className:"text-positive text-6xl"}):n.status==="pending"?t.jsx("div",{className:"flex items-center justify-center flex-auto",children:t.jsx(F,{isIndeterminate:!0,"aria-label":"Waiting for server response..."})}):t.jsx(W,{className:"text-danger text-6xl"}),t.jsx("div",{className:"text-2xl font-semibold mt-30",children:t.jsx(w,{...n.message})}),t.jsx(N,{variant:"flat",color:"primary",className:"w-full mt-30",size:"md",elementType:z,to:n.link,children:t.jsx(w,{...n.buttonLabel})})]},"payment-status"):t.jsx(Z,{},"loading-skeleton")})})}function Z(){return t.jsxs(I.div,{className:"text-center max-w-280",...R,children:[t.jsx(o,{size:"w-50 h-50",variant:"rect"}),t.jsx(o,{className:"text-2xl mt-30"}),t.jsx(o,{size:"h-42",className:"mt-30"})]},"loading-skeleton")}export{ne as B,re as S,Y as l};
//# sourceMappingURL=billing-redirect-message-6a3d6be7.js.map
