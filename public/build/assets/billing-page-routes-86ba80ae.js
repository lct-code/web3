import{bl as M,j as e,ap as U,O as R,aP as F,Q as Y,T as n,N as G,ar as O,ct as Q,au as g,r as o,u as T,B as u,a1 as p,aN as H,f as V,m as b,Y as I,A as W,aU as C,cM as X,cN as J,o as $,ab as E,aV as y,a2 as D,L as w,E as K,U as Z,V as ee,X as se,at as ae,a4 as v,a3 as ne,a0 as te,cO as le,cP as h}from"./main-7ead90d7.js";import{B as N,a as d,u as ie,b as re}from"./use-resume-subscription-e3b27f09.js";import{S as ce,l as oe,B as de}from"./billing-redirect-message-662657f5.js";import{C as me,S as xe}from"./OpenInNew-f475dd53.js";import{E as q}from"./Edit-0ec2419f.js";import"./MoreHoriz-75aa00a5.js";import"./TaskAlt-78631359.js";function ue({children:s}){const{isSubscribed:t}=M();return t?s||e.jsx(R,{}):e.jsx(U,{to:"/pricing",replace:!0})}function je(){const{user:s}=M(),t=F(s.id,{with:["subscriptions.product","subscriptions.price"]});return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(Y,{children:e.jsx(n,{message:"Billing"})}),e.jsx(G,{className:"flex-shrink-0",menuPosition:"billing-page"}),e.jsxs("div",{className:"flex-auto overflow-auto flex flex-col",children:[e.jsx("div",{className:"container mx-auto my-24 px-24 flex-auto",children:t.isLoading?e.jsx(O,{className:"my-80","aria-label":"Loading user..",isIndeterminate:!0}):e.jsx(R,{})}),e.jsx(Q,{className:"flex-shrink-0 container mx-auto px-24"})]})]})}const he="/billing";function ge(){const s=g();return e.jsxs(o.Fragment,{children:[e.jsxs(N,{children:[e.jsx(d,{isLink:!0,onSelected:()=>s(he),children:e.jsx(n,{message:"Billing"})}),e.jsx(d,{children:e.jsx(n,{message:"Payment method"})})]}),e.jsx("h1",{className:"text-3xl font-bold my-32 md:my-64",children:e.jsx(n,{message:"Change payment method"})}),e.jsx(R,{})]})}const pe="/billing";function fe(){const{base_url:s}=T();return e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx(ce,{type:"setupIntent",submitLabel:e.jsx(n,{message:"Change"}),returnUrl:`${s}/billing/change-payment-method/done`}),e.jsx(u,{variant:"outline",className:"w-full mt-16",size:"md",to:pe,elementType:p,type:"button",children:e.jsx(n,{message:"Go back"})})]})}function m(){var a,l,i;const s=F("me",{with:["subscriptions.product","subscriptions.price"]},"billing");return{subscription:(l=(a=s.data)==null?void 0:a.user.subscriptions)==null?void 0:l[0],isLoading:s.isLoading,user:(i=s.data)==null?void 0:i.user}}function S(){H("me")}const A="/billing";function be(){const{billing:{stripe_public_key:s}}=T(),t=g(),[a]=V(),l=a.get("setup_intent_client_secret"),[i,r]=o.useState(),c=o.useRef();return o.useEffect(()=>{c.current||!l||(oe(s).then(x=>{if(!x){r(z());return}x.retrieveSetupIntent(l).then(({setupIntent:j})=>{(j==null?void 0:j.status)==="succeeded"&&ye(j.payment_method).then(()=>{S()}),r(z(j==null?void 0:j.status))})}),c.current=!0)},[s,l]),l?e.jsx(de,{config:i}):(t(A),null)}function z(s){switch(s){case"succeeded":return{...P,message:b("Payment method changed successfully!"),status:"success"};case"processing":return{...P,message:b("Your request is processing. We'll update you when your payment method is confirmed."),status:"success"};case"requires_payment_method":return{...P,message:b("Payment method confirmation failed. Please try another payment method."),status:"error"};default:return{...P,message:b("Something went wrong"),status:"error"}}}const P={link:A,buttonLabel:b("Go back")};function ye(s){return I.post("billing/stripe/change-default-payment-method",{payment_method_id:s})}function f({title:s,children:t}){return e.jsxs("div",{className:"mb-64",children:[e.jsx("div",{className:"text-sm font-medium uppercase pb-16 mb-16 border-b",children:s}),t]})}function ve(){const s=g();return e.jsxs(o.Fragment,{children:[e.jsxs(N,{children:[e.jsx(d,{isLink:!0,onSelected:()=>s("/billing"),children:e.jsx(n,{message:"Billing"})}),e.jsx(d,{children:e.jsx(n,{message:"Plans"})})]}),e.jsx("h1",{className:"text-3xl font-bold my-32 md:my-64",children:e.jsx(n,{message:"Change your plan"})}),e.jsx(f,{title:e.jsx(n,{message:"Available plans"}),children:e.jsx(W,{initial:!1,mode:"wait",children:e.jsx(Ne,{})})})]})}function Ne(){var l,i;const s=C(),[t,a]=o.useState("monthly");return s.isLoading?e.jsx(Ce,{},"plan-skeleton"):e.jsxs(o.Fragment,{children:[e.jsx(X,{products:((l=s.data)==null?void 0:l.products)??[],selectedCycle:t,onChange:a,className:"mb-20",size:"md"}),(i=s.data)==null?void 0:i.products.map(r=>{const c=J(t,r.prices);return c?o.createElement($.div,{...E,key:r.id,className:"md:flex gap-40 justify-between py-32 border-b"},e.jsxs("div",{className:"mb-40 md:mb-0",children:[e.jsx("div",{className:"text-xl font-bold",children:r.name}),e.jsx(y,{price:c,className:"text-lg"}),e.jsx("div",{className:"text-base mt-12",children:r.description}),e.jsx(we,{plan:r})]}),e.jsx(Pe,{product:r,price:c})):null})]},"plan-list")}function we({plan:s}){return s.feature_list.length?e.jsxs("div",{className:"mt-32",children:[e.jsx("div",{className:"text-sm mb-10 font-semibold",children:e.jsx(n,{message:"What's included"})}),s.feature_list.map(t=>e.jsxs("div",{className:"flex items-center gap-10 text-sm",children:[e.jsx(D,{className:"text-positive",size:"sm"}),e.jsx(n,{message:t})]},t))]}):null}function Pe({product:s,price:t}){const{subscription:a}=m();return!(a!=null&&a.price)||!(a!=null&&a.product)?null:a.product_id===s.id&&a.price_id===t.id?e.jsxs("div",{className:"flex items-center justify-center gap-10 w-[168px] text-muted",children:[e.jsx(D,{size:"md"}),e.jsx(n,{message:"Current plan"})]}):e.jsx(u,{variant:"flat",color:"primary",className:"w-[168px]",size:"md",elementType:p,to:`/billing/change-plan/${s.id}/${t.id}/confirm`,children:e.jsx(n,{message:"Continue"})})}function Ce(){return e.jsxs($.div,{...E,className:"text-2xl border-b py-32",children:[e.jsx(w,{className:"mb-8"}),e.jsx(w,{className:"mb-14"}),e.jsx(w,{className:"mb-24"}),e.jsx(w,{className:"mb-12"})]},"plan-skeleton")}function Se(){const{trans:s}=K(),t=g();return Z(a=>_e(a),{onSuccess:()=>{ee(s(b("Plan changed."))),S(),t("/billing")},onError:a=>se(a)})}function _e({subscriptionId:s,...t}){return I.post(`billing/subscriptions/${s}/change-plan`,t).then(a=>a.data)}const k="/billing/change-plan";function ke(){const{productId:s,priceId:t}=ae(),a=g(),l=C(),{subscription:i}=m(),r=Se();if(!l.data||(i==null?void 0:i.price_id)==t)return e.jsx(U,{to:"/billing/change-plan",replace:!0});const c=l.data.products.find(_=>`${_.id}`===s),x=c==null?void 0:c.prices.find(_=>`${_.id}`===t);if(!c||!x||!i)return a(k),null;const j=e.jsxs("span",{className:"whitespace-nowrap",children:[e.jsx(v,{date:i.renews_at,preset:"long"}),";"]});return e.jsxs(o.Fragment,{children:[e.jsxs(N,{children:[e.jsx(d,{isLink:!0,onSelected:()=>a("/billing"),children:e.jsx(n,{message:"Billing"})}),e.jsx(d,{onSelected:()=>a(k),children:e.jsx(n,{message:"Plans"})}),e.jsx(d,{children:e.jsx(n,{message:"Confirm"})})]}),e.jsx("h1",{className:"text-3xl font-bold my-32 md:my-64",children:e.jsx(n,{message:"Confirm your new plan"})}),e.jsx(f,{title:e.jsx(n,{message:"Changing to"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:c.name}),e.jsx(y,{price:x,className:"text-lg"}),e.jsx("div",{className:"text-base mt-12 border-b pb-24 mb-48",children:e.jsx(n,{message:"You will be charged the new price starting :date",values:{date:j}})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"w-full mb-16",onClick:()=>{r.mutate({subscriptionId:i.id,newProductId:c.id,newPriceId:x.id})},disabled:r.isLoading,children:e.jsx(n,{message:"Confirm"})})}),e.jsx("div",{children:e.jsx(u,{variant:"outline",className:"w-full",to:k,elementType:p,children:e.jsx(n,{message:"Go back"})})}),e.jsx("div",{className:"text-xs text-muted mt-12",children:e.jsx(n,{message:"By confirming your new plan, you agree to our terms of Service and privacy policy."})})]})]})})]})}const B="/billing";function Be(){const s=g(),t=C(),{subscription:a}=m(),l=ie(),i=a==null?void 0:a.product,r=a==null?void 0:a.price;if(!t.data)return null;if(!a||!i||!r)return s(B),null;const c=e.jsx("span",{className:"whitespace-nowrap",children:e.jsx(v,{date:a.renews_at,preset:"long"})}),x=()=>{l.mutate({subscriptionId:a.id},{onSuccess:()=>{S(),s("/billing")}})};return e.jsxs(o.Fragment,{children:[e.jsxs(N,{children:[e.jsx(d,{isLink:!0,onSelected:()=>s(B),children:e.jsx(n,{message:"Billing"})}),e.jsx(d,{children:e.jsx(n,{message:"Cancel"})})]}),e.jsx("h1",{className:"text-3xl font-bold my-32 md:my-64",children:e.jsx(n,{message:"Cancel your plan"})}),e.jsx(f,{title:e.jsx(n,{message:"Current plan"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:i.name}),e.jsx(y,{price:r,className:"text-lg"}),e.jsx("div",{className:"text-base mt-12 border-b pb-24 mb-48",children:e.jsxs("div",{className:"hidden",children:[e.jsx(n,{message:"Your plan will be canceled, but is still available until the end of your billing period on :date",values:{date:c}}),e.jsx("div",{className:"mt-20",children:e.jsx(n,{message:"If you change your mind, you can renew your subscription."})})]})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"w-full mb-16",onClick:x,disabled:l.isLoading,children:e.jsx(n,{message:"Cancel plan"})})}),e.jsx("div",{children:e.jsx(u,{variant:"outline",className:"w-full",to:B,elementType:p,children:e.jsx(n,{message:"Go back"})})}),e.jsx("div",{className:"text-xs text-muted mt-12",children:e.jsx(n,{message:"By cancelling your plan, you agree to our terms of service and privacy policy."})})]})]})})]})}const L="/billing";function Le(){const s=g(),t=C(),{subscription:a}=m(),l=re(),i=a==null?void 0:a.product,r=a==null?void 0:a.price;if(!t.data)return null;if(!a||!i||!r)return s(L),null;const c=e.jsxs("span",{className:"whitespace-nowrap",children:[e.jsx(v,{date:a.ends_at,preset:"long"}),";"]}),x=()=>{l.mutate({subscriptionId:a.id},{onSuccess:()=>{S(),s("/billing")}})};return e.jsxs(o.Fragment,{children:[e.jsxs(N,{children:[e.jsx(d,{isLink:!0,onSelected:()=>s(L),children:e.jsx(n,{message:"Billing"})}),e.jsx(d,{children:e.jsx(n,{message:"Renew"})})]}),e.jsx("h1",{className:"text-3xl font-bold my-32 md:my-64",children:e.jsx(n,{message:"Renew your plan"})}),e.jsx(f,{title:e.jsx(n,{message:"Current plan"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:i.name}),e.jsx(y,{price:r,className:"text-lg"}),e.jsx("div",{className:"text-base mt-12 border-b pb-24 mb-48",children:e.jsx(n,{message:"This plan will no longer be canceled. It will renew on :date",values:{date:c}})}),e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"w-full mb-16",onClick:x,disabled:l.isLoading,children:e.jsx(n,{message:"Renew plan"})}),e.jsx(u,{variant:"outline",className:"w-full",to:L,elementType:p,children:e.jsx(n,{message:"Go back"})}),e.jsx("div",{className:"text-xs text-muted mt-12",children:e.jsx(n,{message:"By renewing your plan, you agree to our terms of service and privacy policy."})})]})})]})}function Re(){const{subscription:s}=m();if(!(s!=null&&s.price)||!(s!=null&&s.product))return null;const t=e.jsx("span",{className:"whitespace-nowrap",children:e.jsx(v,{preset:"long",date:s.ends_at})});return e.jsx(f,{title:e.jsx(n,{message:"Current plan"}),children:e.jsxs("div",{className:"flex gap-20 justify-between mt-24",children:[e.jsxs("div",{children:[e.jsx(ne,{className:"w-min mb-10",size:"xs",radius:"rounded",color:"danger",children:e.jsx(n,{message:"Canceled"})}),e.jsx("div",{className:"text-xl font-bold mb-2",children:s.product.name}),e.jsx(y,{className:"text-xl mb-8",price:s.price}),e.jsxs("div",{className:"text-base flex items-center gap-8",children:[e.jsx(me,{size:"sm",className:"text-muted"}),e.jsx(n,{message:"Your plan will be canceled on :date",values:{date:t}})]})]}),e.jsx("div",{className:"w-[233px]",children:e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"w-full mb-12",elementType:p,to:"/billing/renew",children:e.jsx(n,{message:"Renew plan"})})})]})})}function ze(){const{subscription:s}=m();if(!(s!=null&&s.price)||!(s!=null&&s.product))return null;const t=e.jsx(v,{preset:"long",date:s.renews_at}),a=!1;return e.jsx(f,{title:e.jsx(n,{message:"Current plan"}),children:e.jsxs("div",{className:"flex gap-20 justify-between mt-24",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-bold mb-2",children:s.product.name}),e.jsx(y,{className:"text-xl mb-2",price:s.price}),e.jsx("div",{className:"text-base",children:e.jsx(n,{message:"Your plan renews on :date",values:{date:t}})})]}),e.jsxs("div",{className:"w-[233px]",children:[a,e.jsx(u,{variant:"outline",color:"danger",size:"md",className:"w-full",elementType:p,to:"/billing/cancel",children:e.jsx(n,{message:"Cancel plan"})})]})]})})}const Me=""+new URL("paypal-c2a77c63.svg",import.meta.url).href;function Ue(){const{user:s,subscription:t}=m();if(!s||!t)return null;const a=t.gateway_name==="phonesub"?Fe:t.gateway_name==="paypal"?Ie:Te;return e.jsx(f,{title:e.jsx(n,{message:"Payment method"}),children:e.jsx(a,{methodClassName:"whitespace-nowrap text-base max-w-[464px] flex items-center gap-10",linkClassName:"flex items-center gap-4 text-muted mt-18 block hover:underline"})})}function Fe({methodClassName:s,linkClassName:t}){const{user:a}=m();return a?e.jsx(o.Fragment,{children:e.jsxs("div",{className:s,children:[e.jsx(xe,{})," ",e.jsx("span",{className:"capitalize",children:a.phone})]})}):null}function Te({methodClassName:s,linkClassName:t}){const{user:a}=m();return a?e.jsxs(o.Fragment,{children:[e.jsxs("div",{className:s,children:[e.jsx("span",{className:"capitalize",children:a.card_brand})," ••••",a.card_last_four,a.card_expires&&e.jsx("div",{className:"ml-auto",children:e.jsx(n,{message:"Expires :date",values:{date:a.card_expires}})})]}),e.jsxs(p,{className:t,to:"/billing/change-payment-method",children:[e.jsx(q,{size:"sm"}),e.jsx(n,{message:"Change payment method"})]})]}):null}function Ie({methodClassName:s,linkClassName:t}){const{subscription:a}=m();return e.jsxs(o.Fragment,{children:[e.jsx("div",{className:s,children:e.jsx(te,{src:Me})}),e.jsxs("a",{className:t,href:`https://www.sandbox.paypal.com/myaccount/autopay/connect/${a==null?void 0:a.gateway_id}/funding`,target:"_blank",rel:"noreferrer",children:[e.jsx(q,{size:"sm"}),e.jsx(n,{message:"Change payment method"})]})]})}function $e(){const{subscription:s}=m(),t=g();if(!(s!=null&&s.active))return t("/pricing"),null;const a=s.ends_at?e.jsx(Re,{}):e.jsx(ze,{});let l=!1;return e.jsxs("div",{children:[a,e.jsx(Ue,{}),l]})}function Qe(){return e.jsx(le,{children:e.jsxs(h,{path:"/",element:e.jsx(ue,{children:e.jsx(je,{})}),children:[e.jsx(h,{index:!0,element:e.jsx($e,{})}),e.jsxs(h,{path:"change-payment-method",element:e.jsx(ge,{}),children:[e.jsx(h,{index:!0,element:e.jsx(fe,{})}),e.jsx(h,{path:"done",element:e.jsx(be,{})})]}),e.jsx(h,{path:"change-plan",element:e.jsx(ve,{})}),e.jsx(h,{path:"change-plan/:productId/:priceId/confirm",element:e.jsx(ke,{})}),e.jsx(h,{path:"cancel",element:e.jsx(Be,{})}),e.jsx(h,{path:"renew",element:e.jsx(Le,{})})]})})}export{Qe as default};
//# sourceMappingURL=billing-page-routes-86ba80ae.js.map
