import{bl as B,j as s,ap as $,O as te,r as u,cT as se,Q as re,T as g,N as ne,C as ae,cU as ie,at as w,al as oe,Y as v,o as z,aV as ce,cV as ue,cO as le,ab as de,L as C,aU as G,u as L,bk as fe,b6 as be,au as D,x as pe,y as me,cW as ge,p as he,B as Q,V as xe,az as ye,av as M,f as A,m as d,bG as ve,cP as je,cQ as k}from"./main-d9fd37db.js";import{S as we,l as Se,B as F}from"./billing-redirect-message-5c3a8706.js";import"./TaskAlt-dc0f1f14.js";function E({children:e}){const{isLoggedIn:t,isSubscribed:r}=B();return t?t&&r?s.jsx($,{to:"/billing",replace:!0}):e||s.jsx(te,{}):s.jsx($,{to:"/register",replace:!0})}function N({children:e}){const[t,r]=e;return u.useEffect(()=>{se("be.onboarding.selected")},[]),s.jsxs("div",{className:"flex flex-col h-full overflow-y-auto",children:[s.jsx(re,{children:s.jsx(g,{message:"Checkout"})}),s.jsx(ne,{size:"sm",color:"transparent",className:"flex-shrink-0 z-10 mb-20 md:mb-0",textColor:"text-main",logoColor:"dark",darkModeColor:"transparent",menuPosition:"checkout-page-navbar"}),s.jsxs("div",{className:"flex-auto md:flex w-full mx-auto justify-between px-20 md:px-0 md:pt-128 md:max-w-950",children:[s.jsx("div",{className:"hidden md:block fixed right-0 top-0 w-1/2 h-full bg-alt shadow-[15px_0_30px_0_rgb(0_0_0_/_18%)]"}),s.jsxs("div",{className:"md:w-400 overflow-hidden",children:[t,s.jsx(ae,{menu:"checkout-page-footer",className:"text-xs mt-50 text-muted overflow-x-auto"}),s.jsx("div",{className:"mt-40",children:s.jsx(ie,{})})]}),s.jsx("div",{className:"hidden md:block w-384",children:s.jsx("div",{className:"relative z-10",children:r})})]})]})}const W=e=>`billing/products/${e}`;function ke(){var a;const{productId:e,priceId:t}=w(),r=oe([W(e)],()=>Ee(e),{keepPreviousData:!0,enabled:e!=null&&t!=null}),n=(a=r.data)==null?void 0:a.product,i=(n==null?void 0:n.prices.find(o=>o.id===parseInt(t)))||(n==null?void 0:n.prices[0]);return{status:r.status,product:n,price:i}}function Ee(e){return v.get(W(e)).then(t=>t.data)}function R({showBillingLine:e=!0}){const{status:t,product:r,price:n}=ke();return t==="error"||t!=="loading"&&(!r||!n)?null:s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl mb-30",children:s.jsx(g,{message:"Summary"})}),t==="loading"?s.jsx(Ne,{},"loading-skeleton"):s.jsx(Le,{product:r,price:n,showBillingLine:e})]})}function Le({product:e,price:t,showBillingLine:r}){return s.jsxs(z.div,{children:[s.jsx("div",{className:"text-xl font-semibold mb-6",children:e.name}),e.description&&s.jsx("div",{className:"text-sm text-muted",children:e.description}),s.jsx(ce,{priceClassName:"font-bold text-4xl",periodClassName:"text-muted text-xs",variant:"separateLine",price:t,className:"mt-32"}),s.jsx(ue,{product:e}),r&&s.jsxs("div",{className:"flex items-center justify-between gap-24 border-t pt-24 mt-32 font-medium",children:[s.jsx("div",{children:s.jsx(g,{message:"Billed today"})}),s.jsx("div",{children:s.jsx(le,{value:t.amount,currency:t.currency})})]})]})}function Ne(){return s.jsxs(z.div,{...de,className:"max-w-180",children:[s.jsx(C,{className:"text-xl mb-6"}),s.jsx(C,{className:"text-sm"}),s.jsx(C,{className:"text-4xl mt-32"})]})}/*!
 * paypal-js v5.1.4 (2022-11-29T23:08:21.847Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Re(e,t){var r=document.querySelector('script[src="'.concat(e,'"]'));if(r===null)return null;var n=Y(e,t),i=r.cloneNode();if(delete i.dataset.uidAuto,Object.keys(i.dataset).length!==Object.keys(n.dataset).length)return null;var a=!0;return Object.keys(i.dataset).forEach(function(o){i.dataset[o]!==n.dataset[o]&&(a=!1)}),a?r:null}function _e(e){var t=e.url,r=e.attributes,n=e.onSuccess,i=e.onError,a=Y(t,r);a.onerror=i,a.onload=n,document.head.insertBefore(a,document.head.firstElementChild)}function Ce(e){var t="https://www.paypal.com/sdk/js";e.sdkBaseURL&&(t=e.sdkBaseURL,delete e.sdkBaseURL),$e(e);var r=Object.keys(e).filter(function(a){return typeof e[a]<"u"&&e[a]!==null&&e[a]!==""}).reduce(function(a,o){var c=e[o].toString();return o.substring(0,5)==="data-"?a.dataAttributes[o]=c:a.queryParams[o]=c,a},{queryParams:{},dataAttributes:{}}),n=r.queryParams,i=r.dataAttributes;return{url:"".concat(t,"?").concat(Ie(n)),dataAttributes:i}}function Ie(e){var t="";return Object.keys(e).forEach(function(r){t.length!==0&&(t+="&"),t+=r+"="+e[r]}),t}function Pe(e){var t=e.split("/* Original Error:")[1];return t?t.replace(/\n/g,"").replace("*/","").trim():e}function Y(e,t){t===void 0&&(t={});var r=document.createElement("script");return r.src=e,Object.keys(t).forEach(function(n){r.setAttribute(n,t[n]),n==="data-csp-nonce"&&r.setAttribute("nonce",t["data-csp-nonce"])}),r}function $e(e){var t=e["merchant-id"],r=e["data-merchant-id"],n="",i="";return Array.isArray(t)?t.length>1?(n="*",i=t.toString()):n=t.toString():typeof t=="string"&&t.length>0?n=t:typeof r=="string"&&r.length>0&&(n="*",i=r),e["merchant-id"]=n,e["data-merchant-id"]=i,e}function Be(e,t){if(t===void 0&&(t=H()),J(e,t),typeof window>"u")return t.resolve(null);var r=Ce(e),n=r.url,i=r.dataAttributes,a=i["data-namespace"]||"paypal",o=q(a);return Re(n,i)&&o?t.resolve(o):De({url:n,attributes:i},t).then(function(){var c=q(a);if(c)return c;throw new Error("The window.".concat(a," global variable is not available."))})}function De(e,t){t===void 0&&(t=H()),J(e,t);var r=e.url,n=e.attributes;if(typeof r!="string"||r.length===0)throw new Error("Invalid url.");if(typeof n<"u"&&typeof n!="object")throw new Error("Expected attributes to be an object.");return new t(function(i,a){if(typeof window>"u")return i();_e({url:r,attributes:n,onSuccess:function(){return i()},onError:function(){var o=new Error('The script "'.concat(r,'" failed to load.'));return window.fetch?fetch(r).then(function(c){return c.status===200&&a(o),c.text()}).then(function(c){var f=Pe(c);a(new Error(f))}).catch(function(c){a(c)}):a(o)}})})}function H(){if(typeof Promise>"u")throw new Error("Promise is undefined. To resolve the issue, use a Promise polyfill.");return Promise}function q(e){return window[e]}function J(e,t){if(typeof e!="object"||e===null)throw new Error("Expected an options object.");if(typeof t<"u"&&typeof t!="function")throw new Error("Expected PromisePonyfill to be a function.")}function Me({productId:e,priceId:t}){const{data:r}=G(),n=u.useRef(!1),i=u.useRef(!1),[a,o]=u.useState(!1),c=u.useRef(null),{base_url:f,billing:{stripe:{enable:p},paypal:{enable:b,public_key:l}}}=L();return u.useEffect(()=>{!b||!l||n.current||(Be({"client-id":l,intent:"subscription",vault:!0,"disable-funding":p?"card":void 0}).then(()=>{o(!0)}),n.current=!0)},[l,b,p]),u.useEffect(()=>{var S;if(!a||!((S=window.paypal)!=null&&S.Buttons)||!c.current||!(r!=null&&r.products.length)||!e||!t||i.current)return;const m=r.products.find(x=>x.id===parseInt(e)),y=m==null?void 0:m.prices.find(x=>x.id===parseInt(t));window.paypal.Buttons({style:{label:"pay"},createSubscription:(x,j)=>j.subscription.create({application_context:{shipping_preference:"NO_SHIPPING"},plan_id:y==null?void 0:y.paypal_id}),onApprove:(x,j)=>(j.redirect(`${f}/checkout/${e}/${t}/paypal/done?subscriptionId=${x.subscriptionID}&status=success`),Promise.resolve()),onError:x=>{location.href=`${f}/checkout/${e}/${t}/paypal/done?status=error`}}).render(c.current).then(()=>{i.current=!0})},[e,t,r,a,f]),{paypalElementRef:c,stripeIsEnabled:l!=null&&b}}function Ae({type:e,priceId:t}){B(),fe(),u.useRef(!1);const r=u.useRef(null);be();const{branding:{site_name:n},billing:{phonesub:{enable:i}}}=L();return{phonesub:{subscribeStart:async()=>(await v.post("billing/phonesub/subscribe-start",{price_id:t})).data,subscribeVerify:async({auth_code:c})=>(await v.post("billing/phonesub/subscribe-verify",{price_id:t,auth_code:c})).data},paymentElementRef:r,phonesubIsEnabled:i}}function Fe(e){const t=(e==null?void 0:e.length)??0,r=3;return e===void 0?"":e.substring(0,r)+e.substring(r,t-r).replace(/./g,".")+e.substring(t-r)}function Oe({priceId:e,type:t="subscription",submitLabel:r,verifyLabel:n,resendLabel:i,returnUrl:a}){const{phonesub:o,paymentElementRef:c,phonesubIsEnabled:f}=Ae({type:t,priceId:e}),[p,b]=u.useState(null),[l,m]=u.useState(!1),[y,S]=u.useState("start"),x=D(),j=pe(),K=u.useRef(null),{user:_}=B(),X=!f||o!=null,Z=async ee=>{var O,T;if(o){m(!0);try{const h=await o[y!=="verify"?"subscribeStart":"subscribeVerify"](ee);if(h.status=="subscribed"){h.message&&xe(h.message),x(a+"?status=verified&subscriptionId="+((h==null?void 0:h.subscriptionId)??"null"));return}h.status&&S(h.status),((O=h.error)==null?void 0:O.type)!=="validation_error"&&((T=h.error)!=null&&T.message)?b(h.error.message):b(null)}catch{}m(!1)}};return s.jsxs(me,{form:j,onSubmit:Z,children:[y==="verify"&&s.jsxs("div",{children:[s.jsx(ge,{title:s.jsx(g,{message:"Sending verification code"}),type:"info",message:s.jsx(g,{message:"Please enter verification code sent to your phone number: :phone",values:{phone:Fe(_==null?void 0:_.phone)}})}),s.jsx(he,{className:"mb-32",name:"auth_code",type:"text",label:s.jsx(g,{message:"Verification code"}),required:!0,inputRef:K})]}),p&&!l&&s.jsx("div",{className:"text-danger mt-20",children:p}),s.jsx(Q,{variant:"flat",color:"primary",size:"md",className:"w-full mt-40",type:"submit",disabled:l||!X,children:y=="verify"?n:y=="expired"?i:r})]})}function Te(){var l;const{productId:e,priceId:t}=w(),r=G(),{paypalElementRef:n}=Me({productId:e,priceId:t}),{base_url:i,billing:{stripe:a,phonesub:o,paypal:c}}=L(),f=D();if(r.isLoading)return s.jsx(ye,{});const p=(l=r.data)==null?void 0:l.products.find(m=>m.id===parseInt(e)),b=p==null?void 0:p.prices.find(m=>m.id===parseInt(t));return!p||!b||r.status==="error"?s.jsx($,{to:"/pricing",replace:!0}):s.jsxs(N,{children:[s.jsxs(u.Fragment,{children:[s.jsx("h1",{className:"text-4xl mb-40",children:s.jsx(g,{message:"Checkout"})}),o.enable?s.jsxs(u.Fragment,{children:[s.jsx(Oe,{productId:e,priceId:t,submitLabel:s.jsx(g,{message:"Upgrade"}),verifyLabel:s.jsx(g,{message:"Verify code"}),resendLabel:s.jsx(g,{message:"Resend code"}),type:"subscription",returnUrl:`/checkout/${e}/${t}/phonesub/done`}),a.enable||c.enable?s.jsx(I,{}):null]}):null,a.enable?s.jsxs(u.Fragment,{children:[s.jsx(we,{productId:e,submitLabel:s.jsx(g,{message:"Upgrade"}),type:"subscription",returnUrl:`${i}/checkout/${e}/${t}/stripe/done`}),c.enable?s.jsx(I,{}):null]}):null,s.jsx("div",{ref:n}),s.jsx(I,{}),s.jsx(Q,{variant:"flat",color:"chip",size:"md",className:"w-full",type:"button",onClick:()=>{f("/")},children:s.jsx(g,{message:"Go back"})}),s.jsx("div",{className:"text-xs text-muted mt-30",children:s.jsx(g,{message:"You’ll be charged until you cancel your subscription. Previous charges won’t be refunded when you cancel unless it’s legally required. Your payment data is encrypted and secure. By subscribing your agree to our terms of service and privacy policy."})})]}),s.jsx(R,{})]})}function I(){return s.jsx("div",{className:"relative text-center my-20 before:absolute before:left-0 before:top-1/2 before:-translate-y-1/2 before:h-1 before:w-full before:bg-divider",children:s.jsx("span",{className:"bg relative z-10 px-10 text-sm text-muted",children:s.jsx(g,{message:"or"})})})}function qe(){const{invalidateBootstrapData:e}=M(),{productId:t,priceId:r}=w(),n=D(),{billing:{stripe_public_key:i}}=L(),[a]=A(),o=a.get("payment_intent_client_secret"),[c,f]=u.useState(),p=u.useRef();return u.useEffect(()=>{p.current||(Se(i).then(async b=>{if(!b||!o){f(U());return}b.retrievePaymentIntent(o).then(({paymentIntent:l})=>{(l==null?void 0:l.status)==="succeeded"&&Ue(l.id).then(()=>{e()}),f(U(l==null?void 0:l.status,t,r))})}),p.current=!0)},[i,o,r,t,e]),o?s.jsxs(N,{children:[s.jsx(F,{config:c}),s.jsx(R,{showBillingLine:!1})]}):(n("/"),null)}function U(e,t,r){switch(e){case"succeeded":return{message:d("Subscription successful!"),status:"success",buttonLabel:d("Return to site"),link:"/billing"};case"processing":return{message:d("Payment processing. We'll update you when payment is received."),status:"success",buttonLabel:d("Return to site"),link:"/billing"};case"requires_payment_method":return{message:d("Payment failed. Please try another payment method."),status:"error",buttonLabel:d("Go back"),link:V(t,r)};default:return{message:d("Something went wrong"),status:"error",buttonLabel:d("Go back"),link:V(t,r)}}}function V(e,t){return e&&t?`/buy/${e}/${t}`:"/"}function Ue(e){return v.post("billing/stripe/store-subscription-details-locally",{payment_intent_id:e})}function Ve(){const{invalidateBootstrapData:e}=M(),{productId:t,priceId:r}=w(),[n]=A(),[i,a]=u.useState();return u.useEffect(()=>{const o=n.get("subscriptionId"),c=n.get("status");a(ze(c,t,r)),o&&c==="success"&&Qe(o).then(()=>{e()})},[r,t,n,e]),s.jsxs(N,{children:[s.jsx(F,{config:i}),s.jsx(R,{showBillingLine:!1})]})}function ze(e,t,r){switch(e){case"success":return{message:d("Subscription successful!"),status:"success",buttonLabel:d("Return to site"),link:"/billing"};default:return{message:d("Something went wrong. Please try again."),status:"error",buttonLabel:d("Go back"),link:Ge(t,r)}}}function Ge(e,t){return e&&t?`/buy/${e}/${t}`:"/"}function Qe(e){return v.post("billing/paypal/store-subscription-details-locally",{paypal_subscription_id:e})}function We(){const{invalidateBootstrapData:e}=M(),{productId:t,priceId:r}=w(),[n]=A(),[i,a]=u.useState(),[o,c]=u.useState(),[f,p]=ve("redirectedFrom");return u.useEffect(()=>{const b=n.get("subscriptionId"),l=n.get("status");a(P(l,t,r,f)),b&&l==="verified"&&(console.log("verified",o),o||c(setInterval(()=>{He(b).then(m=>{console.log("sync succ",m),clearInterval(o),a(P("success",t,r,f))},m=>{console.log("sync err",m)})},1e3)),setTimeout(()=>{clearInterval(o),a(P("error",t,r,f))},15e3)),b&&l==="success"&&Je(b).then(()=>{e()})},[r,t,n,e]),s.jsxs(N,{children:[s.jsx(F,{config:i}),s.jsx(R,{showBillingLine:!1})]})}function P(e,t,r,n){switch(e){case"success":return{message:d("Subscription successful!"),status:"success",buttonLabel:d("Return to site"),link:n??"/billing"};case"verified":return{message:d("Verification complete, waiting for subscription server..."),status:"pending",buttonLabel:d("Return to site"),link:n??"/billing"};default:return{message:d("Something went wrong. Please try again."),status:"error",buttonLabel:d("Go back"),link:Ye(t,r)}}}function Ye(e,t){return e&&t?`/checkout/${e}/${t}`:"/"}function He(e){return v.post("billing/phonesub/sync-subscription-details",{phonesub_subscription_id:e})}function Je(e){return v.post("billing/phonesub/store-subscription-details-locally",{phonesub_subscription_id:e})}function tt(){return s.jsxs(je,{children:[s.jsx(k,{path:":productId/:priceId",element:s.jsx(E,{children:s.jsx(Te,{})})}),s.jsx(k,{path:":productId/:priceId/stripe/done",element:s.jsx(E,{children:s.jsx(qe,{})})}),s.jsx(k,{path:":productId/:priceId/paypal/done",element:s.jsx(E,{children:s.jsx(Ve,{})})}),s.jsx(k,{path:":productId/:priceId/phonesub/done",element:s.jsx(E,{children:s.jsx(We,{})})})]})}export{tt as default};
//# sourceMappingURL=checkout-routes-bc96b22d.js.map
