import{b_ as la,aF as be,b$ as oa,c0 as rt,m as C,c1 as _e,c2 as ca,c3 as je,c4 as ye,c5 as Ms,c6 as Ls,a as G,j as s,R as We,c as A,i as da,ak as xs,aP as it,aQ as lt,aR as ot,$ as Ie,c7 as ua,c8 as ma,c9 as fs,r as u,ca as Y,h as Ge,cb as ns,cc as rs,cd as he,ce as ve,cf as ct,b as te,b7 as ae,k as Qe,cg as X,ch as xa,ci as fa,cj as ha,ck as pa,cl as ga,cm as ba,n as J,I as B,u as oe,aL as dt,cn as ut,co as ja,ac as mt,ad as xt,T as d,q as hs,H as Ze,B as V,t as Ce,w as De,A as Ye,ao as ne,b8 as Xe,Y as U,ag as Se,d as ps,o as H,S as ya,g as gs,M as bs,a6 as ke,J as pe,a3 as ft,cp as va,bT as ka,cq as wa,cr as Na,au as js,K as Ia,cs as Ca,bZ as Da,e as Oe,D as ee,y as Pe,aN as Es,P as Sa,ct as M,aq as Pa,cu as $a,bb as Aa,cv as Fa,L as ys,U as ce,X as Ta,bd as Us,be as Va,W as se,cw as Ra,cx as za,a9 as Je,p as E,V as de,a1 as $e,x as re,ay as Ae,ap as ue,at as me,b2 as vs,as as ks,v as ws,a8 as ht,_ as pt,a0 as gt,Z as bt,a4 as Z,aD as jt,E as Ma,bx as La,bw as Ea,N as yt,cy as vt,bR as Ua,ax as es,a5 as _a,bA as Oa,af as Ha,aM as qa,cz as Ba,bG as Ka,bH as _s,b0 as kt,b5 as Wa,b1 as wt,Q as Ga}from"./main-96dd97cc.js";import{K as Qa,a as Za,a2 as Ya,S as Nt,A as Ns,C as It,a6 as Xa,G as Is,l as Ja,v as He,a0 as Ct,E as en,w as qe,D as sn,b as Cs,u as tn,_ as Dt,y as an,O as St,p as nn,n as ss,j as Ds,z as ts,t as rn,a7 as ln,X as on,T as cn,o as Ss,F as Be,B as dn,c as un,e as mn,f as xn,g as Re,h as fn,i as ze,a1 as hn,Z as Pt,x as pn,L as Os,P as gn,U as bn,k as $t}from"./play-arrow-filled-f553fd07.js";import{E as Ps}from"./Edit-7d871963.js";const jn=new RegExp("^.*\\(.*\\).*$"),yn=["latn","arab","hanidec"];class At{parse(t){return is(this.locale,this.options,t).parse(t)}isValidPartialNumber(t,a,n){return is(this.locale,this.options,t).isValidPartialNumber(t,a,n)}getNumberingSystem(t){return is(this.locale,this.options,t).options.numberingSystem}constructor(t,a={}){this.locale=t,this.options=a}}const Hs=new Map;function is(e,t,a){let n=qs(e,t);if(!e.includes("-nu-")&&!n.isValidPartialNumber(a)){for(let r of yn)if(r!==n.options.numberingSystem){let i=qs(e+(e.includes("-u-")?"-nu-":"-u-nu-")+r,t);if(i.isValidPartialNumber(a))return i}}return n}function qs(e,t){let a=e+(t?Object.entries(t).sort((r,i)=>r[0]<i[0]?-1:1).join():""),n=Hs.get(a);return n||(n=new vn(e,t),Hs.set(a,n)),n}class vn{parse(t){let a=this.sanitize(t);if(this.symbols.group&&(a=Me(a,this.symbols.group,"")),this.symbols.decimal&&(a=a.replace(this.symbols.decimal,".")),this.symbols.minusSign&&(a=a.replace(this.symbols.minusSign,"-")),a=a.replace(this.symbols.numeral,this.symbols.index),this.options.style==="percent"){let o=a.indexOf("-");a=a.replace("-","");let l=a.indexOf(".");l===-1&&(l=a.length),a=a.replace(".",""),l-2===0?a=`0.${a}`:l-2===-1?a=`0.0${a}`:l-2===-2?a="0.00":a=`${a.slice(0,l-2)}.${a.slice(l-2)}`,o>-1&&(a=`-${a}`)}let n=a?+a:NaN;if(isNaN(n))return NaN;if(this.options.style==="percent"){var r,i;let o={...this.options,style:"decimal",minimumFractionDigits:Math.min(((r=this.options.minimumFractionDigits)!==null&&r!==void 0?r:0)+2,20),maximumFractionDigits:Math.min(((i=this.options.maximumFractionDigits)!==null&&i!==void 0?i:0)+2,20)};return new At(this.locale,o).parse(new la(this.locale,o).format(n))}return this.options.currencySign==="accounting"&&jn.test(t)&&(n=-1*n),n}sanitize(t){return t=t.replace(this.symbols.literals,""),this.symbols.minusSign&&(t=t.replace("-",this.symbols.minusSign)),this.options.numberingSystem==="arab"&&(this.symbols.decimal&&(t=t.replace(",",this.symbols.decimal),t=t.replace(String.fromCharCode(1548),this.symbols.decimal)),this.symbols.group&&(t=Me(t,".",this.symbols.group))),this.options.locale==="fr-FR"&&(t=Me(t,".",String.fromCharCode(8239))),t}isValidPartialNumber(t,a=-1/0,n=1/0){return t=this.sanitize(t),this.symbols.minusSign&&t.startsWith(this.symbols.minusSign)&&a<0?t=t.slice(this.symbols.minusSign.length):this.symbols.plusSign&&t.startsWith(this.symbols.plusSign)&&n>0&&(t=t.slice(this.symbols.plusSign.length)),this.symbols.group&&t.startsWith(this.symbols.group)||this.symbols.decimal&&t.indexOf(this.symbols.decimal)>-1&&this.options.maximumFractionDigits===0?!1:(this.symbols.group&&(t=Me(t,this.symbols.group,"")),t=t.replace(this.symbols.numeral,""),this.symbols.decimal&&(t=t.replace(this.symbols.decimal,"")),t.length===0)}constructor(t,a={}){this.locale=t,this.formatter=new Intl.NumberFormat(t,a),this.options=this.formatter.resolvedOptions(),this.symbols=wn(t,this.formatter,this.options,a);var n,r;this.options.style==="percent"&&(((n=this.options.minimumFractionDigits)!==null&&n!==void 0?n:0)>18||((r=this.options.maximumFractionDigits)!==null&&r!==void 0?r:0)>18)&&console.warn("NumberParser cannot handle percentages with greater than 18 decimal places, please reduce the number in your options.")}}const Bs=new Set(["decimal","fraction","integer","minusSign","plusSign","group"]),kn=[0,4,2,1,11,20,3,7,100,21,.1,1.1];function wn(e,t,a,n){var r,i,o,l;let c=new Intl.NumberFormat(e,{...a,minimumSignificantDigits:1,maximumSignificantDigits:21}),f=c.formatToParts(-10000.111),x=c.formatToParts(10000.111),m=kn.map(w=>c.formatToParts(w));var p;let h=(p=(r=f.find(w=>w.type==="minusSign"))===null||r===void 0?void 0:r.value)!==null&&p!==void 0?p:"-",g=(i=x.find(w=>w.type==="plusSign"))===null||i===void 0?void 0:i.value;!g&&((n==null?void 0:n.signDisplay)==="exceptZero"||(n==null?void 0:n.signDisplay)==="always")&&(g="+");let v=(o=new Intl.NumberFormat(e,{...a,minimumFractionDigits:2,maximumFractionDigits:2}).formatToParts(.001).find(w=>w.type==="decimal"))===null||o===void 0?void 0:o.value,k=(l=f.find(w=>w.type==="group"))===null||l===void 0?void 0:l.value,N=f.filter(w=>!Bs.has(w.type)).map(w=>Ks(w.value)),$=m.flatMap(w=>w.filter(R=>!Bs.has(R.type)).map(R=>Ks(R.value))),D=[...new Set([...N,...$])].sort((w,R)=>R.length-w.length),z=D.length===0?new RegExp("[\\p{White_Space}]","gu"):new RegExp(`${D.join("|")}|[\\p{White_Space}]`,"gu"),L=[...new Intl.NumberFormat(a.locale,{useGrouping:!1}).format(9876543210)].reverse(),j=new Map(L.map((w,R)=>[w,R])),S=new RegExp(`[${L.join("")}]`,"g");return{minusSign:h,plusSign:g,decimal:v,group:k,literals:z,numeral:S,index:w=>String(j.get(w))}}function Me(e,t,a){return e.replaceAll?e.replaceAll(t,a):e.split(t).join(a)}function Ks(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ft(e){return e.set({hour:0,minute:0,second:0,millisecond:0})}function q(e){return e.set({hour:24-1,minute:60-1,second:60-1,millisecond:1e3-1})}function Nn(){var a,n,r;const e=(a=be())==null?void 0:a.settings.dates.default_timezone,t=((r=(n=be())==null?void 0:n.user)==null?void 0:r.timezone)||e||"auto";return!t||t==="auto"?oa():t}const T=Ft(rt(Nn()));var at,nt;const ls=((nt=(at=be())==null?void 0:at.i18n)==null?void 0:nt.language)||"en",Tt=[{key:0,label:C("Today"),getRangeValue:()=>({preset:0,start:T,end:q(T)})},{key:1,label:C("Yesterday"),getRangeValue:()=>({preset:1,start:T.subtract({days:1}),end:q(T).subtract({days:1})})},{key:2,label:C("This week"),getRangeValue:()=>({preset:2,start:_e(T,ls),end:ca(q(T),ls)})},{key:3,label:C("Last week"),getRangeValue:()=>{const e=_e(T,ls).subtract({days:7});return{preset:3,start:e,end:e.add({days:6})}}},{key:4,label:C("Last 7 days"),getRangeValue:()=>({preset:4,start:T.subtract({days:7}),end:q(T)})},{key:6,label:C("Last 30 days"),getRangeValue:()=>({preset:6,start:T.subtract({days:30}),end:q(T)})},{key:7,label:C("Last 3 months"),getRangeValue:()=>({preset:7,start:T.subtract({months:3}),end:q(T)})},{key:8,label:C("Last 12 months"),getRangeValue:()=>({preset:8,start:T.subtract({months:12}),end:q(T)})},{key:9,label:C("This month"),getRangeValue:()=>({preset:9,start:je(T),end:ye(q(T))})},{key:10,label:C("This year"),getRangeValue:()=>({preset:10,start:Ms(T),end:Ls(q(T))})},{key:11,label:C("Last year"),getRangeValue:()=>({preset:11,start:Ms(T).subtract({years:1}),end:Ls(q(T)).subtract({years:1})})}],Vt=G(s.jsx("path",{d:"M7 11h2v2H7v-2zm14-5v14c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2l.01-14c0-1.1.88-2 1.99-2h1V2h2v2h8V2h2v2h1c1.1 0 2 .9 2 2zM5 8h14V6H5v2zm14 12V10H5v10h14zm-4-7h2v-2h-2v2zm-4 0h2v-2h-2v2z"}),"DateRangeOutlined"),Rt=We.forwardRef((e,t)=>{const{children:a,inputProps:n,wrapperProps:r,className:i,autoFocus:o,style:l,onClick:c}=e;return s.jsx("div",{...r,onClick:c,children:s.jsx("div",{...n,role:"group",className:A(i,"flex items-center focus-within:ring focus-within:ring-primary/focus focus-within:border-primary/60"),ref:t,style:l,children:s.jsx(da,{autoFocus:o,children:a})})})}),zt=We.forwardRef(({inputRef:e,wrapperProps:t,children:a,onBlur:n,...r},i)=>{const o=xs(r),l=it(i),{fieldProps:c,inputProps:f}=lt({...r,focusRef:l,labelElementType:"span"});return o.wrapper=A(o.wrapper,r.disabled&&"pointer-events-none"),s.jsx(ot,{wrapperProps:Ie(t,{onBlur:x=>{var m;(m=l.current)!=null&&m.contains(x.relatedTarget)||n==null||n(x)},onClick:()=>{const x=ua(l);x==null||x.focusFirst()}}),fieldClassNames:o,ref:l,...c,children:s.jsx(Rt,{inputProps:f,className:A(o.input,"gap-10"),ref:e,children:a})})});function In(e){return e instanceof ma?"day":"minute"}function ds(e,t,a){return t!=null&&e.compare(t)<0||a!=null&&e.compare(a)>0}function Mt(e,t){const a=fs(),[n,r]=u.useState(!1),i=t.closeDialogOnSelection??!0,o=t.granularity||In(e),l=t.min?Y(t.min,a):void 0,c=t.max?Y(t.max,a):void 0;return{timezone:a,granularity:o,min:l,max:c,calendarIsOpen:n,setCalendarIsOpen:r,closeDialogOnSelection:i}}function Fe(){const e=fs();return u.useMemo(()=>rt(e),[e])}function Ws(e){var le,Q;const t=Fe(),[a,n]=u.useState({start:(!e.value||!e.value.start)&&!((le=e.defaultValue)!=null&&le.start),end:(!e.value||!e.value.end)&&!((Q=e.defaultValue)!=null&&Q.end)}),r=e.onChange,[i,o]=Ge(e.value?cs(e.value,t):void 0,e.value?void 0:cs(e.defaultValue,t),y=>{n({start:!1,end:!1}),r==null||r(y)}),{min:l,max:c,granularity:f,timezone:x,calendarIsOpen:m,setCalendarIsOpen:p,closeDialogOnSelection:h}=Mt(i.start,e),g=u.useCallback(()=>{n({start:!0,end:!0}),o(cs(null,t)),r==null||r(null),p(!1)},[t,o,r,p]),[b,v]=u.useState(null),[k,N]=u.useState(!1),[$,D]=u.useState(i),[z,L]=u.useState(()=>Gs(i,c)),j=u.useCallback(y=>{let I=y.start,F=y.end;l&&(I=ns(I,l));const _=c?rs(c,F):F;I=rs(I,_);const fe=l?ns(l,I):I;return F=ns(F,fe),c&&(F=rs(F,c)),{start:Y(I,x),end:Y(F,x)}},[l,c,x]),S=u.useCallback(y=>{const I={...j(y),preset:y.preset};o(I),D(I),L(Gs(I,c)),n({start:!1,end:!1})},[o,j,c]),P=u.useCallback(y=>!a.start&&he(y,$.start)||!a.end&&he(y,$.end),[$,a]),w=u.useCallback(y=>(k||!a.start&&!a.end)&&y.compare($.start)>=0&&y.compare($.end)<=0,[$,a,k]),R=u.useCallback(y=>he(y,$.start),[$]),K=u.useCallback(y=>he(y,$.end),[$]),ie=u.useCallback((y,I)=>({onPointerEnter:()=>{k&&I&&D(os({start:b,end:y,timezone:x}))},onClick:()=>{if(!k)N(!0),v(y),D(os({start:y,end:y,timezone:x}));else{const F=os({start:b,end:y,timezone:x});F.start=Ft(F.start),F.end=q(F.end),N(!1),v(null),S==null||S(F),h&&(p==null||p(!1))}}}),[b,k,S,p,h,x]);return{selectedValue:i,setSelectedValue:S,calendarIsOpen:m,setCalendarIsOpen:p,dayIsActive:P,dayIsHighlighted:w,dayIsRangeStart:R,dayIsRangeEnd:K,getCellProps:ie,calendarDates:z,setIsPlaceholder:n,isPlaceholder:a,clear:g,setCalendarDates:L,min:l,max:c,granularity:f,timezone:x,closeDialogOnSelection:h}}function Gs(e,t){let a=ve(je(e.start)),n=ve(ye(e.end));return ct(a,n)&&(n=ye(n.add({months:1}))),t&&n.compare(t)>0&&(n=a,a=je(a.subtract({months:1}))),[a,n]}function os(e){const t=Y(e.start,e.timezone),a=Y(e.end,e.timezone);return t.compare(a)>0?{start:a,end:t}:{start:t,end:a}}function cs(e,t){return e!=null&&e.start&&(e!=null&&e.end)?e:!(e!=null&&e.start)&&(e!=null&&e.end)?(e.start=e.end.subtract({months:1}),e):!(e!=null&&e.end)&&(e!=null&&e.start)?(e.end=e.start.add({months:1}),e):{start:t,end:t.add({months:1})}}const Cn=G(s.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4v3z"}),"ArrowRightAltOutlined");function Dn(e,t,a,n){switch(t){case"era":case"year":case"month":case"day":return e.cycle(t,a,{round:t==="year"})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return e.set({hour:i?r-12:r+12})}case"hour":case"minute":case"second":return e.cycle(t,a,{round:t!=="hour",hourCycle:n.hour12?12:24})}return e}function Sn(e,t,a,n){switch(t){case"day":case"month":case"year":return e.set({[t]:a})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return a>=12===i?e:e.set({hour:i?r-12:r+12})}case"hour":if(n.hour12){const i=e.hour>=12;!i&&a===12&&(a=0),i&&a<12&&(a+=12)}case"minute":case"second":return e.set({[t]:a})}return e}const Qs={year:5,month:2,day:7,hour:2,minute:15,second:15,dayPeriod:1};function Pn({segment:e,domProps:t,value:a,onChange:n,isPlaceholder:r,state:{timezone:i,calendarIsOpen:o,setCalendarIsOpen:l}}){const c=te(),f=u.useRef(""),{localeCode:x}=ae(),m=Qe(),p=X({timeZone:i}),h=u.useMemo(()=>new At(x,{maximumFractionDigits:0}),[x]),g=j=>{n(Sn(a,e.type,j,p.resolvedOptions()))},b=j=>{n(Dn(a,e.type,j,p.resolvedOptions()))},v=()=>{if(h.isValidPartialNumber(e.text)){const j=e.text.slice(0,-1),S=h.parse(j);if(j.length===0||S===0){const P=xa(i);e.type in P&&g(P[e.type])}else g(S);f.current=j}else e.type==="dayPeriod"&&b(-1)},k=j=>{var S;if(!(j.ctrlKey||j.metaKey||j.shiftKey||j.altKey)){switch(j.key){case"ArrowLeft":j.preventDefault(),j.stopPropagation(),m==null||m.focusPrevious();break;case"ArrowRight":j.preventDefault(),j.stopPropagation(),m==null||m.focusNext();break;case"Enter":(S=j.target.closest("form"))==null||S.requestSubmit(),l(!o);break;case"Tab":break;case"Backspace":case"Delete":{j.preventDefault(),j.stopPropagation(),v();break}case"ArrowUp":j.preventDefault(),f.current="",b(1);break;case"ArrowDown":j.preventDefault(),f.current="",b(-1);break;case"PageUp":j.preventDefault(),f.current="",b(Qs[e.type]||1);break;case"PageDown":j.preventDefault(),f.current="",b(-(Qs[e.type]||1));break;case"Home":j.preventDefault(),f.current="",g(e.maxValue);break;case"End":j.preventDefault(),f.current="",g(e.minValue);break}z(j.key)}},N=X({hour:"numeric",hour12:!0}),$=u.useMemo(()=>{const j=new Date;return j.setHours(0),N.formatToParts(j).find(S=>S.type==="dayPeriod").value},[N]),D=u.useMemo(()=>{const j=new Date;return j.setHours(12),N.formatToParts(j).find(S=>S.type==="dayPeriod").value},[N]),z=j=>{const S=f.current+j;switch(e.type){case"dayPeriod":if($.toLowerCase().startsWith(j))g(0);else if(D.toLowerCase().startsWith(j))g(12);else break;m==null||m.focusNext();break;case"day":case"hour":case"minute":case"second":case"month":case"year":{if(!h.isValidPartialNumber(S))return;let P=h.parse(S),w=P,R=e.minValue===0;if(e.type==="hour"&&p.resolvedOptions().hour12){switch(p.resolvedOptions().hourCycle){case"h11":P>11&&(w=h.parse(j));break;case"h12":R=!1,P>12&&(w=h.parse(j));break}e.value>=12&&P>1&&(P+=12)}else P>e.maxValue&&(w=h.parse(j));if(Number.isNaN(P))return;const K=w!==0||R;K&&g(w),+`${P}0`>e.maxValue||S.length>=String(e.maxValue).length?(f.current="",K&&(m==null||m.focusNext())):f.current=S;break}}},L=c?{}:{"aria-label":e.type,"aria-valuetext":r?void 0:`${e.value}`,"aria-valuemin":e.minValue,"aria-valuemax":e.maxValue,"aria-valuenow":r?void 0:e.value,tabIndex:0,onKeyDown:k};return s.jsx("div",{...Ie(t,{...L,onFocus:j=>{f.current="",j.target.scrollIntoView({block:"nearest"})},onClick:j=>{j.preventDefault(),j.stopPropagation()}}),className:"box-content cursor-default select-none whitespace-nowrap rounded p-2 text-center tabular-nums caret-transparent outline-none focus:bg-primary focus:text-on-primary",children:e.text.padStart(e.minLength,"0")})}function $n({segment:e,domProps:t}){const a=Qe();return s.jsx("div",{...t,onPointerDown:n=>{n.pointerType==="mouse"&&(n.preventDefault(),a!=null&&a.focusNext({from:n.target})||a==null||a.focusPrevious({from:n.target}))},"aria-hidden":!0,className:"min-w-4 cursor-default select-none",children:e.text})}function An(e,t,a){switch(t){case"year":return{value:e.year,placeholder:"yyyy",minValue:1,maxValue:e.calendar.getYearsInEra(e)};case"month":return{value:e.month,placeholder:"mm",minValue:ha(e),maxValue:e.calendar.getMonthsInYear(e)};case"day":return{value:e.day,minValue:fa(e),maxValue:e.calendar.getDaysInMonth(e),placeholder:"dd"}}if("hour"in e)switch(t){case"dayPeriod":return{value:e.hour>=12?12:0,minValue:0,maxValue:12,placeholder:"--"};case"hour":if(a.hour12){const n=e.hour>=12;return{value:e.hour,minValue:n?12:0,maxValue:n?23:11,placeholder:"--"}}return{value:e.hour,minValue:0,maxValue:23,placeholder:"--"};case"minute":return{value:e.minute,minValue:0,maxValue:59,placeholder:"--"}}return{}}function us({segmentProps:e,state:t,value:a,onChange:n,isPlaceholder:r}){const{granularity:i}=t,o=u.useMemo(()=>{const x={year:"numeric",month:"numeric",day:"numeric"};return i==="minute"&&(x.hour="numeric",x.minute="numeric"),x},[i]),l=X(o),c=u.useMemo(()=>a.toDate(),[a]),f=u.useMemo(()=>l.formatToParts(c).map(x=>{const m=An(a,x.type,l.resolvedOptions()),p=r&&x.type!=="literal"?m.placeholder:x.value;return{type:x.type,text:x.value===", "?" ":p,...m,minLength:x.type!=="literal"?String(m.maxValue).length:1}}),[c,l,r,a]);return s.jsx("div",{className:"flex items-center",children:f.map((x,m)=>x.type==="literal"?s.jsx($n,{domProps:e,segment:x},m):s.jsx(Pn,{isPlaceholder:r,domProps:e,state:t,value:a,onChange:n,segment:x},m))})}function Fn({date:e,currentMonth:t,state:{dayIsActive:a,dayIsHighlighted:n,dayIsRangeStart:r,dayIsRangeEnd:i,getCellProps:o,timezone:l,min:c,max:f}}){const{localeCode:x}=ae(),m=pa(e,x),p=a(e),h=n(e),g=r(e),b=i(e),v=ga(e,l),k=ct(e,t),N=ds(e,c,f);return s.jsxs("div",{role:"button","aria-disabled":N,className:A("w-40 h-40 text-sm relative isolate flex-shrink-0",N&&"text-disabled pointer-events-none",!k&&"invisible pointer-events-none"),...o(e,k),children:[s.jsx("span",{className:A("absolute inset-0 flex items-center justify-center rounded-full w-full h-full select-none z-10 cursor-pointer",!p&&!v&&"hover:bg-hover",p&&"bg-primary text-on-primary font-semibold",v&&!p&&"bg-chip"),children:e.day}),h&&k&&s.jsx("span",{className:A("absolute w-full h-full inset-0 bg-primary/focus",(g||m===0||e.day===1)&&"rounded-l-full",(b||m===6||e.day===t.calendar.getDaysInMonth(t))&&"rounded-r-full")})]})}function Tn({startDate:e,state:t,isFirst:a,isLast:n}){const{localeCode:r}=ae(),i=ba(e,r),o=_e(e,r);return s.jsxs("div",{className:"w-280 flex-shrink-0",children:[s.jsx(Vn,{isFirst:a,isLast:n,state:t,currentMonth:e}),s.jsxs("div",{className:"block",role:"grid",children:[s.jsx(Rn,{state:t,startDate:e}),[...new Array(i).keys()].map(l=>s.jsx(J.div,{className:"flex mb-6",children:[...new Array(7).keys()].map(c=>s.jsx(Fn,{date:o.add({weeks:l,days:c}),currentMonth:e,state:t},c))},l))]})]})}function Vn({currentMonth:e,isFirst:t,isLast:a,state:{calendarDates:n,setCalendarDates:r,timezone:i,min:o,max:l}}){const c=p=>{const h=n.length;let g;p==="forward"?g=n.map(b=>ye(b.add({months:h}))):g=n.map(b=>ye(b.subtract({months:h}))),r(g)},f=X({month:"long",year:"numeric",era:e.calendar.identifier!=="gregory"?"long":void 0,calendar:e.calendar.identifier}),x=ds(e.subtract({days:1}),o,l),m=ds(je(e.add({months:1})),o,l);return s.jsxs("div",{className:"flex items-center justify-between gap-10",children:[s.jsx(B,{size:"md",className:A("text-muted",!t&&"invisible"),disabled:!t||x,"aria-hidden":!t,onClick:()=>{c("backward")},children:s.jsx(Qa,{})}),s.jsx("div",{className:"text-sm font-semibold select-none",children:f.format(e.toDate(i))}),s.jsx(B,{size:"md",className:A("text-muted",!a&&"invisible"),disabled:!a||m,"aria-hidden":!a,onClick:()=>{c("forward")},children:s.jsx(Za,{})})]})}function Rn({state:{timezone:e},startDate:t}){const{localeCode:a}=ae(),n=X({weekday:"short"}),r=_e(t,a);return s.jsx("div",{className:"flex",children:[...new Array(7).keys()].map(i=>{const l=r.add({days:i}).toDate(e),c=n.format(l);return s.jsx("div",{className:"w-40 h-40 text-sm font-semibold relative flex-shrink-0",children:s.jsx("div",{className:"absolute flex items-center justify-center w-full h-full select-none",children:c})},i)})})}function Lt({state:e,visibleMonths:t=1}){return te()&&(t=1),s.jsx(u.Fragment,{children:[...new Array(t).keys()].map(n=>{const r=ve(je(e.calendarDates[n])),i=n===0,o=n===t-1;return s.jsx(Tn,{state:e,startDate:r,isFirst:i,isLast:o},n)})})}const Et=u.memo(({start:e,end:t,options:a,preset:n})=>{const{dates:r}=oe(),i=fs(),o=X(a||dt[n||(r==null?void 0:r.format)]);if(!e||!t)return null;let l;try{l=o.formatRange(Zs(e,i),Zs(t,i))}catch{l=""}return s.jsx(u.Fragment,{children:l})},ut);function Zs(e,t){return typeof e=="string"?ja(e,t).toDate():"toDate"in e?e.toDate(t):e}function zn({onPresetSelected:e,selectedValue:t}){return s.jsx(mt,{children:Tt.map(a=>s.jsx(xt,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(t==null?void 0:t.preset)===a.key,onSelected:()=>{const n=a.getRangeValue();e(n)},children:s.jsx(d,{...a.label})},a.key))})}const Ut=[{key:0,label:C("Preceding period"),getRangeValue:e=>{const t=e.start,r=(e.end.toDate().getTime()-t.toDate().getTime())/(1e3*60);return{preset:0,start:t.subtract({minutes:r}),end:t}}},{key:1,label:C("Same period last year"),getRangeValue:e=>({start:e.start.subtract({years:1}),end:e.end.subtract({years:1}),preset:1})},{key:2,label:C("Custom"),getRangeValue:e=>({start:e.start.subtract({weeks:1}),end:e.end.subtract({weeks:1}),preset:2})}];function Mn({originalRangeValue:e,onPresetSelected:t,selectedValue:a}){return s.jsx(mt,{children:Ut.map(n=>s.jsx(xt,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(a==null?void 0:a.preset)===n.key,onSelected:()=>{const r=n.getRangeValue(e);t(r)},children:s.jsx(d,{...n.label})},n.key))})}function Ln({state:e,compareState:t,showInlineDatePickerField:a=!1,compareVisibleDefault:n=!1}){const r=Ya(),{close:i}=hs(),o=u.useRef(e),l=e.isPlaceholder.start||e.isPlaceholder.end,[c,f]=u.useState(n),x=s.jsxs(Ze,{dividerTop:!0,startAction:!l&&!r?s.jsx("div",{className:"text-xs",children:s.jsx(Et,{start:e.selectedValue.start.toDate(),end:e.selectedValue.end.toDate(),options:{dateStyle:"medium"}})}):void 0,children:[s.jsx(V,{variant:"text",size:"xs",onClick:()=>{e.setSelectedValue(o.current.selectedValue),e.setIsPlaceholder(o.current.isPlaceholder),i()},children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{variant:"flat",color:"primary",size:"xs",onClick:()=>{const m=e.selectedValue;t&&c&&(m.compareStart=t.selectedValue.start,m.compareEnd=t.selectedValue.end),i(m)},children:s.jsx(d,{message:"Select"})})]});return s.jsxs(Ce,{size:"auto",children:[s.jsxs(De,{className:"flex",padding:"p-0",children:[!r&&s.jsxs("div",{className:"min-w-192 py-14",children:[s.jsx(zn,{selectedValue:e.selectedValue,onPresetSelected:m=>{e.setSelectedValue(m),e.closeDialogOnSelection&&i(m)}}),!!t&&s.jsxs(u.Fragment,{children:[s.jsx(Nt,{className:"mx-20 mb-10 mt-14",checked:c,onChange:m=>f(m.target.checked),children:s.jsx(d,{message:"Compare"})}),c&&s.jsx(Mn,{originalRangeValue:e.selectedValue,selectedValue:t.selectedValue,onPresetSelected:m=>{t.setSelectedValue(m)}})]})]}),s.jsx(Ye,{initial:!1,children:s.jsx(En,{state:e,compareState:t,showInlineDatePickerField:a,compareVisible:c})})]}),!e.closeDialogOnSelection&&x]})}function En({state:e,compareState:t,showInlineDatePickerField:a,compareVisible:n}){return s.jsxs(J.div,{initial:{width:0,overflow:"hidden"},animate:{width:"auto"},exit:{width:0,overflow:"hidden"},transition:{type:"tween",duration:.125},className:"border-l px-20 pb-20 pt-10",children:[a&&s.jsxs("div",{children:[s.jsx(Ys,{state:e}),!!t&&n&&s.jsx(Ys,{state:t,label:s.jsx(d,{message:"Compare"})})]}),s.jsx("div",{className:"flex items-start gap-36",children:s.jsx(Lt,{state:e,visibleMonths:2})})]})}function Ys({state:e,label:t}){const{selectedValue:a,setSelectedValue:n}=e;return s.jsxs(zt,{className:"mb-20 mt-10",label:t,children:[s.jsx(us,{state:e,value:a.start,onChange:r=>{n({...a,start:r})}}),s.jsx(Cn,{className:"block flex-shrink-0 text-muted",size:"md"}),s.jsx(us,{state:e,value:a.end,onChange:r=>{n({...a,end:r})}})]})}const xe=(e,t)=>{const a=e.split("/");return t&&a.push(t),a};function $i(e,t,a,n){return ne({queryKey:xe(e,t),queryFn:({signal:r})=>Un(e,t,n,r),placeholderData:Xe,...a})}async function Un(e,t,a,n){t.query&&await new Promise(i=>setTimeout(i,300));const r=await U.get(e,{params:t,signal:t.query?n:void 0}).then(i=>i.data);return a==null||a(r),r}function _t(e,t,a){return ne({queryKey:[e,t],queryFn:()=>_n(e,t),placeholderData:Xe,...a})}async function _n(e,t){return U.get(e,{params:t}).then(a=>a.data)}function Ot(e,t,a){return ne({queryKey:[e,t],queryFn:()=>On(e,t),...a})}async function On(e,t){return U.get(e,{params:t}).then(a=>a.data)}function Hn({label:e,className:t,background:a,value:n,defaultValue:r="",placeholder:i=C("Select item..."),searchPlaceholder:o=C("Find an item..."),onChange:l,description:c,errorMessage:f,invalid:x,autoFocus:m,queryParams:p,endpoint:h,disabled:g,required:b}){var S;const v=u.useRef(null),[k,N]=u.useState(""),[$,D]=Ge(n,r,l),z=_t(h,{query:k,...p}),{trans:L}=H(),j=xs({size:"md"});return $?s.jsxs("div",{className:t,children:[s.jsx("div",{className:j.label,children:e}),s.jsx("div",{className:A("rounded-input border p-8",a,x&&"border-danger"),children:s.jsx(Ye,{initial:!1,mode:"wait",children:s.jsx(qn,{disabled:g,endpoint:h,modelId:$,queryParams:p,onEditClick:()=>{D(""),N(""),requestAnimationFrame(()=>{var P,w;(P=v.current)==null||P.focus(),(w=v.current)==null||w.click()})}})})}),c&&!f&&s.jsx("div",{className:j.description,children:c}),f&&s.jsx("div",{className:j.error,children:f})]}):s.jsx(ya,{className:t,showSearchField:!0,invalid:x,errorMessage:f,description:c,color:"white",isAsync:!0,background:a,placeholder:L(i),searchPlaceholder:L(o),label:e,isLoading:z.isFetching,items:(S=z.data)==null?void 0:S.results,inputValue:k,onInputValueChange:N,selectionMode:"single",selectedValue:$,onSelectionChange:D,ref:v,autoFocus:m,disabled:g,required:b,children:P=>s.jsx(gs,{value:P.id,description:P.description,startIcon:s.jsx(Ns,{src:P.image}),children:P.name},P.id)})}function qn({modelId:e,onEditClick:t,endpoint:a,disabled:n,queryParams:r}){const{data:i,isLoading:o}=Ot(`${a}/${e}`,r);return o||!(i!=null&&i.model)?s.jsx(Bn,{},"skeleton"):s.jsxs(J.div,{className:A("flex items-center gap-10",n&&"pointer-events-none cursor-not-allowed text-disabled"),...bs,children:[i.model.image&&s.jsx(Ns,{src:i.model.image}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm leading-4",children:i.model.name}),s.jsx("div",{className:"text-xs text-muted",children:i.model.description})]}),s.jsx(ke,{label:s.jsx(d,{message:"Change item"}),children:s.jsx(B,{className:"ml-auto text-muted",size:"sm",onClick:t,disabled:n,children:s.jsx(Ps,{})})})]},"preview")}function Bn(){return s.jsxs(J.div,{className:"flex items-center gap-10",...bs,children:[s.jsx(pe,{variant:"rect",size:"w-32 h-32"}),s.jsxs("div",{className:"max-h-[36px] flex-auto",children:[s.jsx(pe,{className:"text-xs"}),s.jsx(pe,{className:"max-h-8 text-xs"})]}),s.jsx(pe,{variant:"icon",size:"w-24 h-24"})]})}function Kn({name:e,...t}){const{clearErrors:a}=Se(),{field:{onChange:n,value:r=""},fieldState:{invalid:i,error:o}}=ps({name:e});return s.jsx(Hn,{value:r,onChange:l=>{n(l),a(e)},invalid:i,errorMessage:o==null?void 0:o.message,...t})}function ms(e){return{id:e,name:`${e}`,description:`${e}`}}function Wn(e,t){const a=u.useRef(null),n=it(t),{displayWith:r=_=>_.name,validateWith:i,children:o,suggestions:l,isLoading:c,inputValue:f,onInputValueChange:x,onItemSelected:m,placeholder:p,onOpenChange:h,chipSize:g="sm",openMenuOnFocus:b=!0,showEmptyMessage:v,value:k,defaultValue:N,onChange:$,valueKey:D,isAsync:z,allowCustomValue:L=!0,showDropdownArrow:j,onChipClick:S,...P}=e,w=xs({...e,flexibleHeight:!0}),[R,K]=Zn(e),[ie,le]=u.useState(!1),Q=s.jsx(js,{isIndeterminate:!0,size:"sm","aria-label":"loading..."}),y=j?s.jsx(Ia,{}):null,{fieldProps:I,inputProps:F}=lt({...P,focusRef:n,endAdornment:c&&ie?Q:y});return s.jsx(ot,{fieldClassNames:w,...I,children:s.jsxs(Rt,{ref:a,className:A("flex flex-wrap items-center",w.input),onClick:()=>{var _;(_=n.current)==null||_.focus()},children:[s.jsx(Gn,{displayChipUsing:r,onChipClick:S,items:R,setItems:K,chipSize:g}),s.jsx(Qn,{size:e.size,showEmptyMessage:v,inputProps:F,inputValue:f,onInputValueChange:x,fieldRef:a,inputRef:n,chips:R,setChips:K,validateWith:i,isLoading:c,suggestions:l,placeholder:p,openMenuOnFocus:b,listboxIsOpen:ie,setListboxIsOpen:le,allowCustomValue:L,children:o})]})})}function Gn({items:e,setItems:t,displayChipUsing:a,chipSize:n,onChipClick:r}){const i=Qe(),o=u.useCallback(l=>{const c=e.findIndex(x=>x.id===l),f=[...e];return c>-1&&(f.splice(c,1),t(f)),f},[e,t]);return s.jsx(It,{className:A("max-w-full flex-shrink-0 flex-wrap",n==="xs"?"my-6":"my-8"),size:n,selectable:!0,children:e.map(l=>s.jsx(ft,{errorMessage:l.errorMessage,adornment:l.image?s.jsx(Ns,{circle:!0,src:l.image}):null,onClick:()=>r==null?void 0:r(l),onRemove:()=>{o(l.id).length?i==null||i.focusPrevious({tabbable:!0}):i==null||i.focusLast()},children:a(l)},l.id))})}function Qn(e){const{inputRef:t,fieldRef:a,validateWith:n,setChips:r,chips:i,suggestions:o,inputProps:l,placeholder:c,openMenuOnFocus:f,listboxIsOpen:x,setListboxIsOpen:m,allowCustomValue:p,isLoading:h,size:g}=e,b=Qe(),v=u.useCallback(y=>{y=(y||[]).filter(I=>{const F=!I||!I.id||!I.name;return!(i.findIndex(fe=>fe.id===(I==null?void 0:I.id))>-1)&&!F}),y.length&&(n&&(y=y.map(I=>n(I))),r([...i,...y]))},[i,r,n]),k=va({...e,clearInputOnItemSelection:!0,isOpen:x,onOpenChange:m,items:o,selectionMode:"none",role:"listbox",virtualFocus:!0,onItemSelected:y=>{K(y)}}),{state:{activeIndex:N,setActiveIndex:$,isOpen:D,setIsOpen:z,inputValue:L,setInputValue:j},refs:S,listboxId:P,collection:w,onInputChange:R}=k,K=y=>{const I=w.size&&N!=null?[...w.values()][N]:null;I!=null&&I.item?v([I.item]):p&&v([ms(I?I.value:y)]),j(""),$(null),z(!1)};ka(()=>{a.current&&S.reference.current!==a.current&&k.reference(a.current)},[a,k,S]);const{handleTriggerKeyDown:ie,handleListboxKeyboardNavigation:le}=Ca(k),Q=Da(()=>{f&&!D&&z(!0)});return s.jsx(wa,{listbox:k,mobileOverlay:Na,isLoading:h,onPointerDown:y=>{y.preventDefault()},children:s.jsx("input",{type:"text",className:A("mx-8 my-4 min-w-30 flex-[1_1_60px] bg-transparent text-sm outline-none",g==="xs"?"h-20":"h-30"),placeholder:c,...Ie(l,{ref:t,value:L,onChange:R,onPaste:y=>{const F=y.clipboardData.getData("text").match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);if(F){y.preventDefault();const _=window.getSelection();_!=null&&_.rangeCount&&(_.deleteFromDocument(),v(F.map(fe=>ms(fe))))}},"aria-autocomplete":"list","aria-controls":D?P:void 0,autoComplete:"off",autoCorrect:"off",spellCheck:"false",onKeyDown:y=>{const I=y.target;if(y.key==="Enter"){y.preventDefault(),K(I.value);return}if(y.key==="Escape"&&D&&(z(!1),j("")),y.key==="ArrowUp"&&D&&(N===0||N==null)){$(null);return}if(N!=null&&(y.key==="ArrowLeft"||y.key==="ArrowRight")){y.preventDefault();return}if((y.key==="ArrowLeft"||y.key==="Backspace"||y.key==="Delete")&&I.selectionStart===0&&N==null&&i.length){b==null||b.focusPrevious({tabbable:!0});return}ie(y)||le(y)},onFocus:Q,onClick:Q})})})}function Zn({onChange:e,value:t,defaultValue:a,valueKey:n}){const r=u.useMemo(()=>Xs(t),[t]),i=u.useMemo(()=>Xs(a),[a]),o=u.useCallback(l=>{const c=n?l.map(f=>f[n]):l;e==null||e(c)},[e,n]);return Ge(r||void 0,i||[],o)}function Xs(e){if(e!=null)return e.map(t=>typeof t!="object"?ms(t):t)}const Yn=We.forwardRef(Wn);function Ht({children:e,...t}){const{field:{onChange:a,onBlur:n,value:r=[],ref:i},fieldState:{invalid:o,error:l}}=ps({name:t.name}),c={onChange:a,onBlur:n,value:r,invalid:o,errorMessage:l==null?void 0:l.message};return s.jsx(Yn,{ref:i,...Ie(c,t),children:e})}function Xn(e){const t=Fe(),[a,n]=u.useState(!e.value&&!e.defaultValue),r=e.onChange,[i,o]=Ge(e.value||t,e.defaultValue||t,D=>{n(!1),r==null||r(D)}),{min:l,max:c,granularity:f,timezone:x,calendarIsOpen:m,setCalendarIsOpen:p,closeDialogOnSelection:h}=Mt(i,e),g=u.useCallback(()=>{n(!0),o(t),r==null||r(null),p(!1)},[t,o,r,p]),[b,v]=u.useState(()=>[ve(i)]),k=u.useCallback(D=>{l&&D.compare(l)<0?D=l:c&&D.compare(c)>0&&(D=c);const z=i?i.set(D):Y(D,x);o(z),v([ve(z)]),n(!1)},[o,l,c,i,x]),N=u.useCallback(D=>!a&&he(i,D),[i,a]),$=u.useCallback(D=>({onClick:()=>{k==null||k(D),h&&(p==null||p(!1))}}),[k,p,h]);return{selectedValue:i,setSelectedValue:o,calendarIsOpen:m,setCalendarIsOpen:p,dayIsActive:N,dayIsHighlighted:()=>!1,dayIsRangeStart:()=>!1,dayIsRangeEnd:()=>!1,getCellProps:$,calendarDates:b,setCalendarDates:v,isPlaceholder:a,clear:g,setIsPlaceholder:n,min:l,max:c,granularity:f,timezone:x,closeDialogOnSelection:h}}function Jn({showCalendarFooter:e,...t}){const a=Xn(t),n=u.useRef(null),r=Fe(),i=e&&s.jsx(Ze,{padding:"px-14 pb-14",startAction:s.jsx(V,{disabled:a.isPlaceholder,variant:"text",color:"primary",onClick:()=>{a.clear()},children:s.jsx(d,{message:"Clear"})}),children:s.jsx(V,{variant:"text",color:"primary",onClick:()=>{a.setSelectedValue(r),a.setCalendarIsOpen(!1)},children:s.jsx(d,{message:"Today"})})}),o=s.jsx(ee,{offset:8,placement:"bottom-start",isOpen:a.calendarIsOpen,onOpenChange:a.setCalendarIsOpen,type:"popover",triggerRef:n,returnFocusToTrigger:!1,moveFocusToDialog:!1,children:s.jsxs(Ce,{size:"auto",children:[s.jsx(De,{className:"flex items-start gap-40",padding:e?"px-24 pt-20 pb-10":null,children:s.jsx(Lt,{state:a,visibleMonths:1})}),i]})}),l={onClick:c=>{c.stopPropagation(),c.preventDefault(),sr(c)?a.setCalendarIsOpen(!1):a.setCalendarIsOpen(!0)}};return s.jsxs(u.Fragment,{children:[s.jsx(zt,{ref:n,wrapperProps:l,endAdornment:s.jsx(Vt,{className:A(t.disabled&&"text-disabled")}),...t,children:s.jsx(us,{segmentProps:l,state:a,value:a.selectedValue,onChange:a.setSelectedValue,isPlaceholder:a.isPlaceholder})}),o]})}function er(e){const{min:t,max:a}=e,{trans:n}=H(),{format:r}=X(),{field:{onChange:i,onBlur:o,value:l=null,ref:c},fieldState:{invalid:f,error:x}}=ps({name:e.name,rules:{validate:h=>{if(!h)return;const g=Oe(h);if(t&&g.compare(t)<0)return n({message:"Enter a date after :date",values:{date:r(h)}});if(a&&g.compare(a)>0)return n({message:"Enter a date before :date",values:{date:r(h)}})}}}),m=l?Oe(l):null,p={onChange:h=>{i(h&&h.toAbsoluteString())},onBlur:o,value:m,invalid:f,errorMessage:x==null?void 0:x.message,inputRef:c};return s.jsx(Jn,{...Ie(p,e)})}function sr(e){return["hour","minute","dayPeriod"].includes(e.currentTarget.ariaLabel||"")}const tr=G(s.jsx("path",{d:"M20 9H4v2h16V9zM4 15h16v-2H4v2z"}),"DragHandleOutlined");function ar(){const[e,t]=u.useState(!1),a=u.useRef(),n=u.useCallback(r=>{var i;if(r){const o=new IntersectionObserver(([l])=>t(l.intersectionRatio<1),{threshold:[1]});a.current=o,o.observe(r)}else a.current&&((i=a.current)==null||i.disconnect())},[]);return{isSticky:e,sentinelRef:n}}function Te({onSubmit:e,form:t,title:a,subTitle:n,children:r,actions:i,backButton:o,isLoading:l=!1,disableSaveWhenNotDirty:c=!1,wrapInContainer:f=!0}){const{isSticky:x,sentinelRef:m}=ar(),p=c?Object.keys(t.formState.dirtyFields).length:!0;return s.jsxs(Pe,{onSubmit:e,onBeforeSubmit:()=>t.clearErrors(),form:t,children:[s.jsx("div",{ref:m}),s.jsx("div",{className:A("sticky top-0 z-10 my-12 transition-shadow md:my-24",x&&"bg shadow"),children:s.jsxs("div",{className:A("flex items-center gap-24 py-14 md:items-start",f&&"container mx-auto px-24"),children:[o,s.jsxs("div",{className:"overflow-hidden overflow-ellipsis md:mr-64",children:[s.jsx("h1",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-xl md:text-3xl",children:a}),n&&s.jsx("div",{className:"mt-4",children:n})]}),s.jsx("div",{className:"mr-auto"}),i,s.jsx(V,{variant:"flat",color:"primary",type:"submit",disabled:l||!p,children:s.jsx(d,{message:"Save"})})]})}),s.jsx("div",{className:f?"container mx-auto px-24 pb-24":void 0,children:s.jsx("div",{className:"rounded",children:r})})]})}const qt=""+new URL("music-7a11c2fe.svg",import.meta.url).href;function nr(e){return ne({queryKey:["artists","search-suggestions",e],queryFn:()=>rr(e),placeholderData:Xe})}async function rr(e){return U.get("search/suggestions/artist",{params:e}).then(t=>t.data)}function Bt({name:e,className:t}){const{trans:a}=H(),[n,r]=u.useState(""),{data:i,isLoading:o}=nr({query:n});return s.jsx(Ht,{className:t,name:e,label:s.jsx(d,{message:"Artists"}),isAsync:!0,inputValue:n,onInputValueChange:r,suggestions:i==null?void 0:i.results,placeholder:a(C("+Add artist")),isLoading:o,allowCustomValue:!1,children:i==null?void 0:i.results.map(l=>s.jsx(gs,{value:l,startIcon:l.image?s.jsx("img",{className:"rounded-full object-cover w-24 h-24",src:l.image,alt:""}):void 0,children:l.name},l.id))})}function we({name:e,label:t,placeholder:a,model:n,className:r,allowCustomValue:i=!1}){const[o,l]=u.useState(""),{data:c,isLoading:f}=_t(`normalized-models/${n}`,{query:o});return s.jsx(Ht,{className:r,name:e,label:t,isAsync:!0,inputValue:o,onInputValueChange:l,suggestions:c==null?void 0:c.results,placeholder:a,isLoading:f,allowCustomValue:i,children:c==null?void 0:c.results.map(x=>s.jsx(gs,{value:x,startIcon:x.image?s.jsx("img",{className:"h-24 w-24 rounded-full object-cover",src:x.image,alt:""}):void 0,children:x.name},x.id))})}const Kt="tag",Wt=G(s.jsx("path",{d:"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zM7 9l1.41 1.41L11 7.83V16h2V7.83l2.59 2.58L17 9l-5-5-5 5z"}),"FileUploadOutlined");function Gt({fileUpload:e,status:t,className:a}){const n=(e==null?void 0:e.bytesUploaded)||0,r=u.useMemo(()=>Es(e.file.size),[e.file.size]),i=u.useMemo(()=>Es(n),[n]);let o;return t==="completed"?o=s.jsx(d,{message:"Upload complete"}):t==="aborted"?o=s.jsx(d,{message:"Upload cancelled"}):t==="failed"?o=s.jsx(d,{message:"Upload failed"}):t==="processing"?o=s.jsx(d,{message:"Processing upload..."}):t==="pending"?o=s.jsx(d,{message:"Waiting to start..."}):o=s.jsx(d,{message:":bytesUploaded of :totalBytes uploaded",values:{bytesUploaded:i,totalBytes:r}}),s.jsx("div",{className:A("text-muted text-xs",a),children:o})}function Qt({fileUpload:e,status:t,onAbort:a,size:n="md",className:r}){return s.jsxs("div",{className:r,children:[s.jsxs("div",{className:"flex items-center gap-24 justify-between",children:[s.jsx(Gt,{fileUpload:e,status:t}),s.jsx(ir,{fileUpload:e,status:t,onAbort:a})]}),s.jsx(Sa,{size:n==="sm"?"xs":"sm",radius:"rounded-sm",value:e.percentage,isIndeterminate:t==="processing"||t==="pending"})]})}function ir({fileUpload:e,status:t,onAbort:a}){M(i=>i.abortUpload),M(i=>i.clearInactive);const n=e.errorMessage;let r;if(t==="failed"){const i=n||C("This file could not be uploaded");r=s.jsx(Le,{children:s.jsx(ke,{variant:"danger",label:s.jsx(Pa,{value:i}),children:s.jsx($a,{className:"text-danger",size:"sm"})})})}else t==="aborted"?r=s.jsx(Le,{children:s.jsx(Aa,{className:"text-warning",size:"sm"})}):t==="completed"||t==="processing"?r=s.jsx(Le,{children:s.jsx(Fa,{size:"sm",className:"text-primary"})}):a?r=s.jsx(Le,{children:s.jsx(B,{size:"xs",onClick:()=>a(e.file.id),children:s.jsx(ys,{})})}):r=s.jsx("div",{className:"w-30 h-30"});return s.jsx(Ye,{children:r})}function Le({children:e,...t}){return s.jsx(J.div,{className:"flex w-30 h-30 items-center justify-center",...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function lr(){return ce({mutationFn:e=>or(e),onError:e=>Ta(e)})}function or(e){return U.post(`tracks/${e.fileEntryId}/extract-metadata`,e).then(t=>cr(t.data))}function cr(e){const t={name:e.metadata.title,duration:e.metadata.duration,genres:e.metadata.genres||[],description:e.metadata.comment,lyric:e.metadata.lyrics,release_date:e.metadata.release_date,album_name:e.metadata.album_name};return e.metadata.album&&(t.album_id=e.metadata.album.id),e.metadata.artist&&(t.artists=[e.metadata.artist]),e.metadata.image&&(t.image=e.metadata.image.url),t}function Zt(e,t){var a,n;!((a=e.getValues("artists"))!=null&&a.length)&&t.artists&&e.setValue("artists",t.artists),!e.getValues("image")&&t.image&&e.setValue("image",t.image),t.release_date&&e.setValue("release_date",t.release_date),(n=t.genres)!=null&&n.length&&e.setValue("genres",Ue(e.getValues("genres"),t.genres)),!e.getValues("name")&&t.album_name&&e.setValue("name",t.album_name)}function Ne(e,t){return{...t,...e,artists:Ue(t.artists,e.artists),genres:Ue(t.genres,e.genres,"name"),tags:Ue(t.tags,e.tags,"name")}}function Ue(e=[],t=[],a="id"){return t=t.filter(n=>!e.find(r=>r[a]===n[a])),[...e,...t]}const dr=50*1024*1024;function as(e){const{uploads:t}=oe(),a=u.useMemo(()=>({allowedFileTypes:[Us.audio,Us.video],maxFileSize:t.max_size||dr}),[t.max_size]),n=lr(),r=u.useRef(e);r.current=e;const i=M(h=>h.uploadMultiple),o=M(h=>h.updateFileUpload),l=M(h=>h.getUpload),c=u.useCallback((h,g)=>{var b;o(h,{meta:{...((b=l(h))==null?void 0:b.meta)||{},...g}})},[o,l]),f=u.useMemo(()=>({metadata:{diskPrefix:"track_media",disk:Va.public},restrictions:a,onSuccess:(h,g)=>{c(g.id,{isExtractingMetadata:!0}),n.mutate({fileEntryId:h.id,autoMatchAlbum:r.current.autoMatchAlbum},{onSuccess:b=>{c(g.id,{isExtractingMetadata:!1});const v={...b,src:h.url};r.current.onMetadataChange(g,v)},onError:()=>{c(g.id,{isExtractingMetadata:!1})}})},onError:h=>{h&&se.danger(h)}}),[n,c,a]),x=u.useCallback(h=>{const g=h.filter(b=>!Ra(b,a));return h.length!==g.length&&se.danger(C(":count of your files is not supported.",{values:{count:h.length-g.length}})),g},[a]),m=u.useCallback(async h=>{if(x(h).length){h.forEach(b=>{var v,k;(k=(v=r.current).onUploadStart)==null||k.call(v,{name:b.name,uploadId:b.id})}),i(h,f);for(const b of h){c(b.id,{isGeneratingWave:!0});const v=await Xa(b.native);v&&r.current.onMetadataChange(b,{waveData:v}),c(b.id,{isGeneratingWave:!1})}}},[f,i,c,x]);return{openFilePicker:u.useCallback(async()=>{const h=await za({multiple:!0,types:a.allowedFileTypes});await m(h)},[m,a]),uploadTracks:m,validateUploads:x}}function $s(e){const t=M(r=>e?r.fileUploads.get(e):null);let a=!1,n;if(t){const r=t.meta,i=(r==null?void 0:r.isExtractingMetadata)||(r==null?void 0:r.isGeneratingWave);a=(t==null?void 0:t.status)==="pending"||(t==null?void 0:t.status)==="inProgress"||!!i,n=(t==null?void 0:t.status)==="completed"&&i?"processing":t==null?void 0:t.status}return{isUploading:a,status:n,activeUpload:t}}function ur(){const[e,t]=u.useState(),{setValue:a,watch:n,getValues:r}=Se(),{openFilePicker:i}=as({onUploadStart:({uploadId:m})=>t(m),onMetadataChange:(m,p)=>{const h=Ne(p,r());Object.entries(h).forEach(([g,b])=>a(g,b,{shouldDirty:!0}))}}),{status:o,isUploading:l,activeUpload:c}=$s(e),{abortUpload:f,clearInactive:x}=M();return s.jsxs("div",{children:[s.jsx(V,{className:"w-full",variant:"flat",color:"primary",startIcon:s.jsx(Wt,{}),disabled:l,onClick:()=>i(),children:n("src")?s.jsx(d,{message:"Replace file"}):s.jsx(d,{message:"Upload file"})}),c&&s.jsx(Qt,{fileUpload:c,status:o,className:"mt-24",onAbort:m=>{f(m),x()}})]})}function Ve({showExternalIdFields:e,showAlbumField:t=!0,uploadButton:a}){const{trans:n}=H(),r=te();return s.jsxs("div",{className:"gap-24 md:flex",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Je,{name:"image",diskPrefix:"track_image",variant:r?"input":"square",label:r?s.jsx(d,{message:"Image"}):null,previewSize:r?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),s.jsx("div",{className:"mt-24",children:a||s.jsx(ur,{})})]}),s.jsxs("div",{className:"mt-24 flex-auto md:mt-0",children:[s.jsx(E,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),t&&s.jsx(Kn,{className:"mb-24",label:s.jsx(d,{message:"Album"}),name:"album_id",endpoint:"search/suggestions/album"}),s.jsx(Bt,{name:"artists",className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:n(C("+Add genre")),model:Is,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Tags"}),placeholder:n(C("+Add tag")),model:Kt,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(E,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),s.jsx(fr,{}),e&&s.jsx(mr,{}),e&&s.jsx(xr,{})]})]})}function mr(){return s.jsx(E,{name:"src",label:s.jsx(d,{message:"Playback source"}),className:"mb-24",minLength:1,maxLength:230,description:s.jsx(d,{message:"Supports audio, video, hls/dash stream and youtube video url. If left empty, best matching youtube video will be found automatically."})})}function xr(){const{spotify_is_setup:e}=oe();return e?s.jsx(E,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function fr(){const{watch:e}=Se();return s.jsx(E,{required:!0,name:"duration",label:s.jsx(d,{message:"Duration (in milliseconds)"}),className:"mb-24",type:"number",min:1,max:864e5,description:s.jsx(d,{message:"Will appear on the site as: :preview",values:{preview:s.jsx(Ja,{ms:e("duration")})}})})}const Yt="tracks";function Xt(e,{onSuccess:t}={}){const{trans:a}=H();return ce({mutationFn:n=>hr(n),onSuccess:n=>{se(a(C("Track created"))),de.invalidateQueries({queryKey:xe(Yt)}),t==null||t(n)},onError:n=>$e(n,e)})}function hr(e){return U.post(Yt,As(e)).then(t=>t.data)}function As(e){var t;return{...e,album_id:e.album_id?e.album_id:null,artists:(t=e.artists)==null?void 0:t.map(a=>a.id)}}function Jt({onTrackCreated:e,defaultValues:t}={}){const a=re({defaultValues:t}),n=Xt(a,{onSuccess:e});return{form:a,createTrack:n}}function Ai({wrapInContainer:e}){const t=Ae(),{pathname:a}=ue(),{form:n,createTrack:r}=Jt({onTrackCreated:i=>{a.includes("admin")?t(`/admin/tracks/${i.track.id}/edit`):t(He(i.track))}});return s.jsx(Te,{form:n,onSubmit:i=>{r.mutate(i)},title:s.jsx(d,{message:"Add new track"}),isLoading:r.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(me,{children:s.jsx(Ve,{showExternalIdFields:!0})})})}const pr=e=>`tracks/${e}`;function gr(e,t={}){const{trans:a}=H();return ce({mutationFn:n=>br(n),onSuccess:n=>{var r;se(a(C("Track updated"))),de.invalidateQueries({queryKey:xe("tracks")}),(r=t.onSuccess)==null||r.call(t,n)},onError:n=>$e(n,e)})}function br({id:e,...t}){return U.put(pr(e),As(t)).then(a=>a.data)}function ea(e,t={}){var r;const a=re({defaultValues:{...e,image:e.image||((r=e.album)==null?void 0:r.image)}}),n=gr(a,{onSuccess:t.onTrackUpdated});return{form:a,updateTrack:n}}function Fi({wrapInContainer:e}){const t=Ct({loader:"editTrackPage"});return t.data?s.jsx(jr,{track:t.data.track,wrapInContainer:e}):s.jsx(vs,{query:t,loaderClassName:"absolute inset-0 m-auto",loaderIsScreen:!1})}function jr({track:e,wrapInContainer:t}){const{canEdit:a}=en([e]),n=Ae(),{pathname:r}=ue(),{form:i,updateTrack:o}=ea(e,{onTrackUpdated:l=>{r.includes("admin")?n("/admin/tracks"):n(He(l.track))}});return a?s.jsx(Te,{form:i,onSubmit:l=>{o.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}}),isLoading:o.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(me,{children:s.jsx(Ve,{showExternalIdFields:!0})})}):s.jsx(ks,{to:"/",replace:!0})}const sa="albums";function ta(e){const{trans:t}=H();return ce({mutationFn:a=>yr(a),onSuccess:()=>{se(t(C("Album created"))),de.invalidateQueries({queryKey:xe(sa)})},onError:a=>$e(a,e)})}function yr(e){return U.post(sa,aa(e)).then(t=>t.data)}function aa(e){var t,a;return{...e,artists:(t=e.artists)==null?void 0:t.map(n=>n.id),tracks:(a=e.tracks)==null?void 0:a.map(n=>As(n))}}const vr=e=>`albums/${e}`;function kr(e,t){const{trans:a}=H(),n=Ae(),{pathname:r}=ue();return ce({mutationFn:i=>wr(t,i),onSuccess:i=>{se(a(C("Album updated"))),de.invalidateQueries({queryKey:xe("albums")}),r.includes("admin")?n("/admin/albums"):n(qe(i.album))},onError:i=>$e(i,e)})}function wr(e,t){return U.put(vr(e),aa(t)).then(a=>a.data)}function Nr({track:e,hideAlbumField:t}){const{formId:a,close:n}=hs(),{form:r}=ea(e);return s.jsxs(Ce,{size:"fullscreen",children:[s.jsx(ws,{children:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}})}),s.jsx(De,{children:s.jsx(Pe,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx(Ve,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Ze,{children:[s.jsx(V,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Update"})})]})]})}function Ir({defaultValues:e,hideAlbumField:t}){const{formId:a,close:n}=hs(),{form:r}=Jt({defaultValues:e});return s.jsxs(Ce,{size:"fullscreen",children:[s.jsx(ws,{children:s.jsx(d,{message:"Add new track"})}),s.jsx(De,{children:s.jsx(Pe,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx(Ve,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Ze,{children:[s.jsx(V,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Create"})})]})]})}function Cr(){const e=Se(),{watch:t,setValue:a,getValues:n}=e,{fields:r,remove:i,prepend:o,move:l}=ht({name:"tracks"}),c=(m,p)=>{var g;const h=(g=n("tracks"))==null?void 0:g.findIndex(b=>b.uploadId===m);h!=null&&a(`tracks.${h}`,Ne(p,n(`tracks.${h}`)),{shouldDirty:!0})},{openFilePicker:f}=as({onUploadStart:m=>o(Ne(m,{artists:e.getValues("artists"),genres:e.getValues("genres"),tags:e.getValues("tags")})),onMetadataChange:(m,p)=>{Zt(e,p),c(m.id,p)}}),x=t("tracks")||[];return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"my-24 text-xl font-semibold",children:s.jsx(d,{message:"Tracks"})}),s.jsx(V,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(Wt,{}),onClick:()=>f(),children:s.jsx(d,{message:"Upload tracks"})}),s.jsxs(ee,{type:"modal",onClose:m=>{m&&o(m)},children:[s.jsx(ke,{label:s.jsx(d,{message:"Create track"}),children:s.jsx(B,{variant:"outline",color:"primary",size:"xs",children:s.jsx(Cs,{})})}),s.jsx(Ir,{hideAlbumField:!0,defaultValues:{artists:t("artists"),tags:t("tags"),genres:t("genres")}})]})]}),r.map((m,p)=>{const h=x[p];return s.jsx(Dr,{track:h,onRemove:()=>i(p),onSort:(g,b)=>l(g,b),tracks:x,onUpdate:g=>{c(h.uploadId,g)}},m.id)}),r.length?null:s.jsx(pt,{className:"mt-40",image:s.jsx(gt,{src:qt}),title:s.jsx(d,{message:"This album does not have any tracks yet"})})]})}function Dr({track:e,tracks:t,onRemove:a,onUpdate:n,onSort:r}){const i=u.useRef(null),o=u.useRef(null),l=M(p=>p.abortUpload),c=M(p=>e.uploadId?p.fileUploads.get(e.uploadId):null),{isUploading:f,status:x}=$s(e.uploadId),{sortableProps:m}=tn({disabled:f,ref:i,item:e,items:t,type:"albumFormTrack",preview:o,strategy:"line",onSortEnd:(p,h)=>{r(p,h)}});return s.jsxs("div",{className:"border-b border-t border-t-transparent py-4",ref:i,...m,children:[s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(B,{className:"mr-14 flex-shrink-0",disabled:f,children:s.jsx(tr,{})}),s.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.name}),c&&s.jsxs("div",{className:"mr-10 flex items-center",children:[s.jsx(Gt,{fileUpload:c,status:x,className:"mr-10"}),s.jsx(js,{isIndeterminate:x==="processing",value:c.percentage,size:"sm"})]}),s.jsxs(ee,{type:"modal",onClose:p=>{p&&n(p)},children:[s.jsx(ke,{label:s.jsx(d,{message:"Edit track"}),children:s.jsx(B,{className:"ml-auto flex-shrink-0 text-muted",disabled:f,children:s.jsx(Ps,{})})}),s.jsx(Nr,{track:e,hideAlbumField:!0})]}),s.jsxs(ee,{type:"modal",onClose:p=>{p&&(e.uploadId&&l(e.uploadId),a())},children:[s.jsx(ke,{label:s.jsx(d,{message:"Remove track"}),children:s.jsx(B,{className:"flex-shrink-0 text-muted",children:s.jsx(ys,{})})}),s.jsx(bt,{isDanger:!0,title:s.jsx(d,{message:"Remove track"}),body:s.jsx(d,{message:"Are you sure you want to remove this track from the album?"}),confirm:s.jsx(d,{message:"Remove"})})]})]}),s.jsx(Sr,{track:e,ref:o})]})}const Sr=We.forwardRef(({track:e},t)=>{var n,r;let a=e.name;return(n=e.artists)!=null&&n.length&&(a+=`- ${(r=e.artists)==null?void 0:r[0].name}`),s.jsx(sn,{ref:t,children:()=>s.jsx("div",{className:"rounded bg-chip p-8 text-sm shadow",children:a})})});function Fs({showExternalIdFields:e}){const{trans:t}=H(),a=te();return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:"gap-24 md:flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Je,{name:"image",diskPrefix:"album_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:"md:w-full md:w-224 md:aspect-square",stretchPreview:!0})}),s.jsxs("div",{className:"mt-24 flex-auto md:mt-0",children:[s.jsx(E,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),s.jsx(er,{name:"release_date",label:s.jsx(d,{message:"Release date"}),className:"mb-24",granularity:"day"}),s.jsx(Bt,{name:"artists",className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:t(C("+Add genre")),model:Is,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Tags"}),placeholder:t(C("+Add tag")),model:Kt,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(E,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),e&&s.jsx(Pr,{})]})]}),s.jsx(Cr,{})]})}function Pr(){const{spotify_is_setup:e}=oe();return e?s.jsx(E,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function Ti({wrapInContainer:e}){const t=Dt({loader:"editAlbumPage"});return t.data?s.jsx(me,{children:s.jsx($r,{album:t.data.album,wrapInContainer:e})}):s.jsx(vs,{query:t,loaderIsScreen:!1,loaderClassName:"absolute inset-0 m-auto"})}function $r({album:e,wrapInContainer:t}){const{canEdit:a}=an(e),n=!!M(o=>o.activeUploadsCount),r=re({defaultValues:{image:e.image,name:e.name,release_date:e.release_date,artists:e.artists,genres:e.genres,tags:e.tags,description:e.description,spotify_id:e.spotify_id,tracks:e.tracks}}),i=kr(r,e.id);return a?s.jsx(Te,{form:r,onSubmit:o=>{i.mutate(o)},title:s.jsx(d,{message:"Edit “:name“ album",values:{name:e.name}}),isLoading:i.isPending||n,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(Fs,{showExternalIdFields:!0})}):s.jsx(ks,{to:"/",replace:!0})}const Ar=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=St(),i=Fe(),[o,l]=u.useState(!1),c=re({defaultValues:{tracks:[],artists:r?[r]:[],release_date:i.toAbsoluteString()}}),f=c.watch("tracks")||[],x=M(v=>v.abortUpload),m=!!M(v=>v.activeUploadsCount),{openFilePicker:p,uploadTracks:h,validateUploads:g}=as({onUploadStart:v=>{l(!0),c.setValue("tracks",[...c.getValues("tracks"),v]),e()},onMetadataChange:(v,k)=>{Zt(c,k),c.setValue("tracks",c.getValues("tracks").map(N=>N.uploadId===v.id?Ne(k,N):N))}});u.useImperativeHandle(n,()=>({openFilePicker:p,uploadTracks:h,validateUploads:g}),[p,h,g]);const b=ta(c);return o?s.jsxs(Pe,{className:"rounded border p-14 md:p-24 mb-30 bg-paper",form:c,onSubmit:v=>b.mutate(v,{onSuccess:k=>{l(!1),c.reset(),a(k.album)}}),children:[s.jsx(Fs,{showExternalIdFields:!1}),s.jsxs("div",{className:"mt-24",children:[s.jsx(V,{variant:"text",onClick:()=>{f.forEach(v=>{x(v.uploadId)}),c.reset(),l(!1),t()},className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{type:"submit",variant:"flat",color:"primary",disabled:m||b.isPending,children:s.jsx(d,{message:"Save"})})]})]}):null}),Fr=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=St(),i=M(m=>m.abortUpload),[o,l]=u.useState([]),{openFilePicker:c,uploadTracks:f,validateUploads:x}=as({onUploadStart:m=>{l(p=>r?[...p,{...m,artists:[r]}]:[...p,m]),e()},onMetadataChange:(m,p)=>{l(h=>h.map(g=>g.uploadId===m.id?Ne(p,g):g))}});return u.useImperativeHandle(n,()=>({openFilePicker:c,uploadTracks:f,validateUploads:x}),[c,f,x]),s.jsx("div",{className:"w-full",children:o.map(m=>s.jsx(Tr,{track:m,onCreate:p=>{l(h=>h.filter(g=>g.uploadId!==m.uploadId)),a(p)},onRemove:()=>{l(p=>{const h=p.filter(g=>g.uploadId!==m.uploadId);return h.length||t(),h}),i(m.uploadId)}},m.uploadId))})}),Tr=u.memo(({track:e,onRemove:t,onCreate:a})=>{const n=re({defaultValues:e}),r=Xt(n),i=M(f=>f.fileUploads.get(e.uploadId)),{isUploading:o,status:l}=$s(e.uploadId);u.useEffect(()=>{n.reset(e)},[e,n]);const c=o&&i?s.jsx(Qt,{fileUpload:i,status:l}):null;return s.jsxs(Pe,{form:n,onSubmit:f=>{r.mutate(f,{onSuccess:x=>a(x.track)})},className:"rounded border p-14 md:p-24 mb-30 bg-paper",children:[s.jsx(Ve,{uploadButton:c,showExternalIdFields:!1}),s.jsx(V,{variant:"text",onClick:()=>t(),className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{type:"submit",variant:"flat",color:"primary",disabled:r.isPending||!n.watch("src"),children:s.jsx(d,{message:"Save"})})]})}),Vr=""+new URL("album-border-b5dd7d9f.png",import.meta.url).href;function Rr({media:e}){var n,r;const t=e.model_type===nn,a=t?qe(e,{absolute:!0}):He(e,{absolute:!0});return s.jsxs("div",{className:"flex items-center gap-28 border rounded bg-paper p-20 my-20 mx-auto w-780 max-w-full",children:[s.jsxs("div",{className:A(t&&"relative isolate my-14 mx-18"),children:[t?s.jsx(ss,{album:e,className:"rounded flex-shrink-0 z-20 relative",size:"w-132 h-132"}):s.jsx(Ds,{track:e,className:"rounded flex-shrink-0 z-20 relative",size:"w-132 h-132"}),t&&s.jsx("img",{className:"absolute block w-160 h-160 max-w-160 -top-14 -left-14 z-10",src:Vr,alt:""})]}),s.jsxs("div",{className:"flex-auto",children:[s.jsx("div",{className:"text-base font-bold",children:e.name}),s.jsx("div",{className:"text-muted text-sm mb-14",children:s.jsx(ts,{artists:e.artists})}),(n=e.genres)!=null&&n.length?s.jsx(It,{selectable:!1,size:"sm",className:"mb-14",children:(r=e.genres)==null?void 0:r.map(i=>s.jsx(ft,{children:i.display_name||i.name},i.id))}):null,s.jsx("div",{className:"text-sm",children:s.jsx(d,{message:"Upload complete. <a>Go to your track</a>",values:{a:i=>s.jsx(Z,{className:jt,to:t?qe(e):He(e),children:i})}})})]}),s.jsx("div",{className:"ml-auto flex-auto max-w-300",children:s.jsxs("div",{className:"text-muted text-sm",children:[s.jsx(d,{message:"Share your new track"}),s.jsx(rn,{name:e.name,image:e.image,link:a}),s.jsx(Ma,{value:a,readOnly:!0,className:"mt-24 w-full",size:"sm",onClick:i=>{i.target.select()}})]})})]})}function zr({isVisible:e}){const t=s.jsx(J.div,{...bs,transition:{duration:.3},className:"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none",children:s.jsx(J.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded",children:s.jsx(d,{message:"Drop your files anywhere on the page to upload"})})},"dragTargetMask");return s.jsx(Ye,{children:e?t:null})}function Mr(){const{user:e}=be();e!=null&&e.id&&de.resetQueries({queryKey:["minutesLimit",e.id]})}function Lr(){const{user:e}=La(),t=e==null?void 0:e.id;return ne({queryKey:["minutesLimit",t],queryFn:()=>Er(t),enabled:t!=null})}function Er(e){return U.get(`users/${e}/minutes-left`).then(t=>t.data)}const Ur=""+new URL("light-bg-8c37cb47.svg",import.meta.url).href,_r=""+new URL("dark-bg-38ecc414.svg",import.meta.url).href;function Or({children:e,...t}){const a=Ea();return s.jsxs("div",{className:"h-screen flex flex-col",...t,children:[s.jsx(yt,{className:"flex-shrink-0",color:"bg",darkModeColor:"bg"}),s.jsx("div",{className:"overflow-y-auto flex-auto bg-cover relative",style:{backgroundImage:`url(${a?_r:Ur})`},children:s.jsxs("div",{className:"container mx-auto p-14 md:p-24 min-h-full flex flex-col",children:[s.jsx("div",{className:"flex-auto",children:e}),s.jsx(vt,{})]})})]})}function Vi({backstageLayout:e=!0}){return s.jsx(me,{children:s.jsx(Hr,{backstageLayout:e})})}function Hr({backstageLayout:e}){const[t,a]=u.useState("tracks"),[n,r]=u.useState(!1),i=u.useRef(null),o=t==="tracks"?Fr:Ar,[l,c]=u.useState([]),f=u.useRef(null),[x,m]=u.useState(!1),{droppableProps:p}=ln({id:"uploadPageRoot",ref:f,types:["nativeFile"],onDragEnter:()=>m(!0),onDragLeave:()=>m(!1),onDrop:async g=>{var b,v;if(g.type==="nativeFile"){const k=await g.getData(),N=(b=i.current)==null?void 0:b.validateUploads(k);N!=null&&N.length&&((v=i.current)==null||v.uploadTracks(N))}}}),h=e?Or:Br;return s.jsxs(h,{...p,children:[!n&&s.jsx(qr,{onUpload:()=>{var g;return(g=i.current)==null?void 0:g.openFilePicker()},uploadMode:t,onUploadModeChange:a}),l.map(g=>s.jsx(Rr,{media:g},g.id)),s.jsx(o,{ref:i,onUploadStart:()=>r(!0),onCreate:g=>{c(b=>[...b,g]),Mr()},onCancel:()=>{r(!1)}}),s.jsx(zr,{isVisible:x})]})}function qr({onUpload:e,uploadMode:t,onUploadModeChange:a}){const{data:n}=Lr();return s.jsxs("div",{className:"pt-40",children:[s.jsxs("div",{className:"border rounded p-20 md:p-48 flex flex-col items-center max-w-580 mx-auto bg-paper",children:[s.jsx("h1",{className:"text-base md:text-[22px] md:font-light",children:s.jsx(d,{message:"Drag and drop your tracks, videos & albums here."})}),s.jsx(V,{variant:"flat",color:"primary",className:"mt-20 w-min",onClick:()=>e(),children:s.jsx(d,{message:"Or choose files to upload"})}),s.jsx("div",{className:"border-t pt-20 mt-20",children:s.jsx(Nt,{checked:t==="album",onChange:r=>a(r.target.checked?"album":"tracks"),children:s.jsx(d,{message:"Make an album when multiple files are selected"})})})]}),s.jsx("div",{className:"text-muted mt-20 text-sm text-center min-h-20",children:(n==null?void 0:n.minutesLeft)!=null&&s.jsx(d,{message:"You have :count minutes left. Try <a>Pro accounts</a> to get more time and access to advanced features.",values:{count:n.minutesLeft,a:r=>s.jsx(Z,{className:jt,to:"/pricing",children:r})}})})]})}function Br({children:e,...t}){return s.jsx("div",{...t,className:"min-h-full relative",children:s.jsx("div",{className:"container mx-auto p-14 md:p-24",children:e})})}function Ri({wrapInContainer:e}){return s.jsx(me,{children:s.jsx(Kr,{wrapInContainer:e})})}function Kr({wrapInContainer:e}){const t=!!M(x=>x.activeUploadsCount),a=Fe(),n=Ae(),{pathname:r}=ue(),[i]=Ua(),{data:o}=Ot(`normalized-models/artist/${i.get("artistId")}`,void 0,{enabled:!!i.get("artistId")}),l=o==null?void 0:o.model,c=re({defaultValues:{release_date:a.toAbsoluteString()}}),f=ta(c);return u.useEffect(()=>{l&&c.reset({artists:[l]})},[l,c]),s.jsx(Te,{form:c,onSubmit:x=>{f.mutate(x,{onSuccess:m=>{r.includes("admin")?n(l?`/admin/artists/${l.id}/edit`:"/admin/albums"):n(qe(m.album))}})},title:s.jsx(d,{message:"Add new album"}),isLoading:f.isPending||t,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(Fs,{showExternalIdFields:!0})})}function zi(){const{requestId:e}=es();return ne({queryKey:["backstage-request",+e],queryFn:()=>Wr(e)})}function Wr(e){return U.get(`backstage-request/${e}`).then(t=>t.data)}const Mi=G(s.jsx("path",{d:"M7 3H4v3H2V1h5v2zm15 3V1h-5v2h3v3h2zM7 21H4v-3H2v5h5v-2zm13-3v3h-3v2h5v-5h-2zM17 6H7v12h10V6zm2 12c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v12zM15 8H9v2h6V8zm0 3H9v2h6v-2zm0 3H9v2h6v-2z"}),"DocumentScannerOutlined"),na=G(s.jsx("path",{d:"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),"InfoDialogTrigger"),Gr=[{key:"name",allowsSorting:!0,header:()=>s.jsx(d,{message:"Name"}),visibleInMode:"all",width:"flex-3",body:e=>s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx(ss,{album:e,className:"flex-shrink-0",size:"w-34 h-34 rounded"}),s.jsx(Ss,{album:e,target:"_blank"})]})},{key:"release_date",allowsSorting:!0,header:()=>s.jsx(d,{message:"Release date"}),body:e=>e.release_date?s.jsx(_a,{date:e.release_date}):null},{key:"track_count",allowsSorting:!1,header:()=>s.jsx(d,{message:"Track count"}),body:e=>e.tracks_count?s.jsx(Be,{value:e.tracks_count}):null},{key:"plays",allowsSorting:!0,header:()=>s.jsx(d,{message:"Plays"}),body:e=>e.plays?s.jsx(Be,{value:e.plays}):null},{key:"actions",header:()=>s.jsx(d,{message:"Actions"}),width:"w-84 flex-shrink-0",visibleInMode:"all",hideHeader:!0,align:"end",body:e=>s.jsx(Zr,{album:e})}];function Qr({albums:e=[]}){const{watch:t}=Se(),a=t("id"),{data:n,sortDescriptor:r,onSortChange:i}=on(e);return s.jsxs("div",{children:[s.jsxs("div",{className:"my-24",children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"text-xl font-semibold",children:s.jsx(d,{message:"Albums"})}),s.jsx(V,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(Cs,{}),elementType:a?Z:void 0,to:`../../../albums/new?artistId=${a}`,relative:"path",disabled:!a,children:s.jsx(d,{message:"Add album"})})]}),!a&&s.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[s.jsx(na,{viewBox:"0 0 16 16",size:"xs",className:"text-muted"}),s.jsx(d,{message:"Save changes to enable album creation."})]})]}),s.jsx(cn,{columns:Gr,data:e,sortDescriptor:r,onSortChange:i,enableSelection:!1}),n.length?null:s.jsx(pt,{className:"mt-40",image:s.jsx(gt,{src:qt}),title:s.jsx(d,{message:"This artist does not have any albums yet"})})]})}function Zr({album:e}){const t=dn();return s.jsxs("div",{className:"text-muted",children:[s.jsx(Z,{to:`../../../albums/${e.id}/edit`,relative:"path",children:s.jsx(B,{size:"md",children:s.jsx(Ps,{})})}),s.jsxs(ee,{type:"modal",onClose:a=>{a&&t.mutate({albumId:e.id})},children:[s.jsx(B,{size:"md",disabled:t.isPending,children:s.jsx(ys,{})}),s.jsx(bt,{isDanger:!0,title:s.jsx(d,{message:"Delete album"}),body:s.jsx(d,{message:"Are you sure you want to delete this album?"}),confirm:s.jsx(d,{message:"Delete"})})]})]})}function Yr({albums:e,showExternalFields:t}){const a=te();return s.jsxs(me,{children:[s.jsxs("div",{className:"md:flex gap-24",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Je,{name:"image_small",diskPrefix:"artist_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:a?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),t&&s.jsx(un,{name:"verified",className:"mt-14",children:s.jsx(d,{message:"Verified"})})]}),s.jsx("div",{className:"flex-auto mt-24 md:mt-0",children:s.jsxs(mn,{isLazy:!0,children:[s.jsxs(xn,{children:[s.jsx(Re,{children:s.jsx(d,{message:"Details"})}),s.jsx(Re,{children:s.jsx(d,{message:"Links"})}),s.jsx(Re,{children:s.jsx(d,{message:"Biography"})}),s.jsx(Re,{children:s.jsx(d,{message:"Images"})})]}),s.jsxs(fn,{className:"pt-20",children:[s.jsx(ze,{children:s.jsx(Xr,{showExternalFields:t})}),s.jsx(ze,{children:s.jsx(hn,{})}),s.jsx(ze,{children:s.jsx(Jr,{})}),s.jsx(ze,{children:s.jsx(ei,{})})]})]})})]}),s.jsx(Qr,{albums:e})]})}function Xr({showExternalFields:e}){const{trans:t}=H();return s.jsxs(u.Fragment,{children:[s.jsx(E,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0,disabled:!e}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:t(C("+Add genre")),model:Is,name:"genres",allowCustomValue:!0,className:"mb-24"}),e&&s.jsx(si,{})]})}function Jr(){return s.jsxs(u.Fragment,{children:[s.jsx(E,{name:"profile.country",label:s.jsx(d,{message:"Country"}),className:"mb-24"}),s.jsx(E,{name:"profile.city",label:s.jsx(d,{message:"City"}),className:"mb-24"}),s.jsx(E,{inputElementType:"textarea",rows:5,name:"profile.description",label:s.jsx(d,{message:"Description"}),className:"mb-24"})]})}function ei(){const{fields:e,append:t,remove:a}=ht({name:"profile_images"});return s.jsxs("div",{children:[s.jsx("div",{className:"flex gap-12 flex-wrap mb-24",children:e.map((n,r)=>s.jsx(Je,{name:`profile_images.${r}.url`,diskPrefix:"artist_images",variant:"square",previewSize:"w-160 h-160",stretchPreview:!0,showRemoveButton:!0,onChange:i=>{i||a(r)}},n.id))}),s.jsx(V,{variant:"outline",color:"primary",startIcon:s.jsx(Cs,{}),onClick:()=>{t({url:""})},children:s.jsx(d,{message:"Add another image"})})]})}function si(){const{spotify_is_setup:e}=oe();return e?s.jsx(E,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}const ti=e=>`artists/${e}`;function ai(e){const{trans:t}=H(),a=Ae(),{pathname:n}=ue();return ce({mutationFn:r=>ni(r),onSuccess:r=>{se(t(C("Artist updated"))),de.invalidateQueries({queryKey:xe("artists")}),n.includes("admin")?a("/admin/artists"):a(Oa(r.artist))},onError:r=>$e(r,e)})}function ni({id:e,...t}){return U.put(ti(e),t).then(a=>a.data)}function Li({wrapInContainer:e,showExternalFields:t}){const a=Pt({loader:"editArtistPage"});return a.data?s.jsx(ri,{response:a.data,wrapInContainer:e,showExternalFields:t}):s.jsx(vs,{query:a,loaderClassName:"absolute inset-0 m-auto"})}function ri({response:e,wrapInContainer:t,showExternalFields:a}){var o;const{canEdit:n}=pn(e.artist),r=re({defaultValues:{id:e.artist.id,name:e.artist.name,verified:e.artist.verified,spotify_id:e.artist.spotify_id,genres:e.artist.genres,image_small:e.artist.image_small,links:e.artist.links,profile:e.artist.profile,profile_images:e.artist.profile_images}}),i=ai(r);return n?s.jsx(Te,{form:r,onSubmit:l=>{i.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ artist",values:{name:e.artist.name}}),isLoading:i.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(Yr,{albums:(o=e.albums)==null?void 0:o.data,showExternalFields:a})}):s.jsx(ks,{to:"/",replace:!0})}const ii={month:"short",day:"2-digit"};function li({value:e,onChange:t,disabled:a,compactOnMobile:n=!0,enableCompare:r=!1,granularity:i="minute"}){const o=te();return s.jsxs(ee,{type:"popover",onClose:l=>{l&&t(l)},children:[s.jsx(V,{variant:"outline",color:"chip",endIcon:s.jsx(Vt,{}),disabled:a,children:s.jsx(Et,{start:e.start,end:e.end,options:o&&n?ii:dt.short})}),s.jsx(oi,{value:e,enableCompare:r,granularity:i})]})}function oi({value:e,enableCompare:t,granularity:a}){const n=te(),r=Ws({granularity:a,defaultValue:{start:e.start,end:e.end,preset:e.preset},closeDialogOnSelection:!1}),i=!!e.compareStart&&!!e.compareEnd,o=Ws({granularity:a,defaultValue:i?{start:e.compareStart,end:e.compareEnd,preset:e.comparePreset}:Ut[0].getRangeValue(r.selectedValue)});return s.jsx(Ln,{state:r,compareState:t?o:void 0,compareVisibleDefault:i,showInlineDatePickerField:!n})}function Ts(e){const{title:t,description:a,children:n,className:r,contentIsFlex:i=!0,contentClassName:o,contentRef:l,minHeight:c="min-h-440"}=e;return s.jsxs("div",{className:A("rounded-panel flex h-full flex-auto flex-col border bg",c,r),children:[s.jsxs("div",{className:"flex flex-shrink-0 items-center justify-between p-14 text-xs",children:[s.jsx("div",{className:"text-sm font-semibold",children:t}),a&&s.jsx("div",{className:"text-muted",children:a})]}),s.jsx("div",{ref:l,className:A("relative p-14",i&&"flex flex-auto items-center justify-center",o),children:n})]})}function Ke(){return s.jsxs("div",{className:"flex items-center gap-10 text-sm absolute mx-auto",children:[s.jsx(js,{isIndeterminate:!0,size:"sm"}),s.jsx(d,{message:"Chart loading"})]})}const ci=u.lazy(()=>Ha(()=>import("./lazy-chart-586a57ea.js"),["./lazy-chart-586a57ea.js","./main-96dd97cc.js","./main-c5ca8fb6.css"],import.meta.url));function ra(e){const{title:t,description:a,className:n,contentRef:r,isLoading:i}=e;return s.jsx(Ts,{title:t,description:a,className:n,contentRef:r,children:s.jsxs(u.Suspense,{fallback:s.jsx(Ke,{}),children:[s.jsx(ci,{...e}),i&&s.jsx(Ke,{})]})})}function ia(e,{localeCode:t="en",shareFirstDatasetLabels:a=!0}){if(!e)return{datasets:[]};const n=[];return{...e,datasets:e.datasets.map((r,i)=>{const o=r.data.map((l,c)=>{let f;return i===0||!a?(f=di(l,e.granularity,t),n[c]=f):f=n[c],{...f,value:l.value}});return{...r,data:o}})}}function di(e,t,a){return e.label?{label:e.label}:e.date?ui(e,t,a):{label:""}}function ui({date:e,endDate:t},a="day",n){const r=Oe(e).toDate(),i=t?Oe(t).toDate():null;switch(a){case"minute":return{label:O(n,{second:"2-digit"}).format(r),tooltipTitle:O(n,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(r)};case"hour":return{label:O(n,{hour:"numeric",minute:"numeric"}).format(r),tooltipTitle:O(n,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(r)};case"day":return{label:O(n,{day:"2-digit",weekday:"short"}).format(r),tooltipTitle:O(n,{day:"2-digit",weekday:"short",month:"short"}).format(r)};case"week":return{label:O(n,{month:"short",day:"2-digit"}).format(r),tooltipTitle:O(n,{day:"2-digit",month:"long",year:"numeric"}).formatRange(r,i)};case"month":return{label:O(n,{month:"short",year:"numeric"}).format(r),tooltipTitle:O(n,{month:"long",year:"numeric"}).format(r)};case"year":return{label:O(n,{year:"numeric"}).format(r),tooltipTitle:O(n,{year:"numeric"}).format(r)}}}const O=qa((e,t)=>new Ba(e,t),{equals:(e,t)=>ut(e,t),callTimeout:void 0}),Js=be().themes.all[0].values["--be-primary"],ge=[[`rgb(${Js.replaceAll(" ",",")})`,`rgba(${Js.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],mi={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function xi({data:e,className:t,...a}){const{localeCode:n}=ae(),r=u.useMemo(()=>{const i=ia(e,{localeCode:n});return i.datasets=i.datasets.map((o,l)=>({...o,backgroundColor:ge[l][1],borderColor:ge[l][0],pointBackgroundColor:ge[l][0]})),i},[e,n]);return s.jsx(ra,{...a,className:A(t,"min-w-500"),data:r,type:"line",options:mi})}const fi={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function et({data:e,className:t,...a}){const{localeCode:n}=ae(),r=u.useMemo(()=>{var o;const i=ia(e,{localeCode:n});return i.labels=(o=i.datasets[0])==null?void 0:o.data.map(l=>l.label),i.datasets=i.datasets.map((l,c)=>({...l,backgroundColor:ge.map(f=>f[1]),borderColor:ge.map(f=>f[0]),borderWidth:2})),i},[e,n]);return s.jsx(ra,{type:"polarArea",data:r,options:fi,className:A(t,"min-w-500"),...a})}const st="https://www.gstatic.com/charts/loader.js";function hi({placeholderRef:e,data:t,country:a,onCountrySelected:n}){const{trans:r}=H(),{analytics:i}=oe(),o=i==null?void 0:i.gchart_api_key,{selectedTheme:l}=Ka(),c=u.useRef(),f=!!n&&!a,x=u.useCallback(()=>{var v,k;if(typeof google>"u")return;const p=t.map(N=>[N.label,N.value]);p.unshift([r(a?C("City"):C("Country")),r(C("Clicks"))]);const h=`${Os(l.values["--be-paper"])}`,b={colorAxis:{colors:[`${Os(l.values["--be-primary"])}`]},backgroundColor:h,region:a?a.toUpperCase():void 0,resolution:a?"provinces":"countries",displayMode:a?"markers":"regions",enableRegionInteractivity:f};!c.current&&e.current&&((v=google==null?void 0:google.visualization)!=null&&v.GeoChart)&&(c.current=new google.visualization.GeoChart(e.current)),(k=c.current)==null||k.draw(google.visualization.arrayToDataTable(p),b)},[l,t,e,r,a,f]),m=u.useCallback(async()=>{_s.isLoadingOrLoaded(st)||(await _s.loadAsset(st,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:o}),x())},[o,x]);return u.useEffect(()=>(c.current&&n&&google.visualization.events.addListener(c.current,"regionClick",p=>n==null?void 0:n(p.region)),()=>{c.current&&google.visualization.events.removeAllListeners(c.current)}),[n,c.current]),u.useEffect(()=>{m()},[m]),u.useEffect(()=>{x()},[l,x,t]),{drawGoogleChart:x}}const pi=G(s.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBackOutlined");function gi({title:e,body:t,dialogSize:a="sm",className:n}){return s.jsxs(ee,{type:"popover",triggerOnHover:!0,children:[s.jsx(B,{className:A("ml-4 text-muted opacity-70",n),iconSize:"xs",size:"2xs",children:s.jsx(na,{viewBox:"0 0 16 16"})}),s.jsxs(Ce,{size:a,children:[e&&s.jsx(ws,{padding:"px-18 pt-12",size:"md",hideDismissButton:!0,children:e}),s.jsx(De,{children:t})]})]})}const bi=u.memo(({code:e})=>{const{localeCode:t}=ae(),a=new Intl.DisplayNames([t],{type:"region"});let n;try{n=a.of(e.toUpperCase())}catch{}return s.jsx(u.Fragment,{children:n})});function ji({data:e,isLoading:t,onCountrySelected:a,country:n,...r}){const i=u.useRef(null),o=!!a,l=e==null?void 0:e.datasets[0].data,c=u.useMemo(()=>l||[],[l]);return hi({placeholderRef:i,data:c,country:n,onCountrySelected:a}),s.jsxs(Ts,{...r,className:"min-w-500",title:s.jsxs("div",{className:"flex items-center",children:[s.jsx(d,{message:"Top Locations"}),n?s.jsxs("span",{className:"pl-4",children:["(",s.jsx(bi,{code:n}),")"]}):null,o&&s.jsx(yi,{})]}),contentIsFlex:t,children:[t&&s.jsx(Ke,{}),s.jsxs("div",{className:"flex gap-24",children:[s.jsx("div",{ref:i,className:"flex-auto w-[480px] min-h-[340px]"}),s.jsxs("div",{className:"w-[170px]",children:[s.jsx("div",{className:"text-sm max-h-[340px] w-full flex-initial overflow-y-auto",children:c.map(f=>s.jsxs("div",{className:A("flex items-center gap-4 mb-4",o&&"cursor-pointer hover:underline"),role:o?"button":void 0,onClick:()=>{a==null||a(f.code)},children:[s.jsx("div",{className:"max-w-110 whitespace-nowrap overflow-hidden overflow-ellipsis",children:f.label}),s.jsxs("div",{children:["(",f.percentage,")%"]})]},f.label))}),n&&s.jsx(V,{variant:"outline",size:"xs",className:"mt-14",startIcon:s.jsx(pi,{}),onClick:()=>{a==null||a(void 0)},children:s.jsx(d,{message:"Back to countries"})})]})]})]})}function yi(){return s.jsx(gi,{title:s.jsx(d,{message:"Zooming in"}),body:s.jsx(d,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const tt="reports/insights";function vi(e,t){return ne({queryKey:[tt,e],queryFn:()=>ki(tt,e),placeholderData:t.isEnabled?Xe:void 0,enabled:t.isEnabled})}function ki(e,t){var n;const a={model:t.model,metrics:(n=t.metrics)==null?void 0:n.join(",")};return a.startDate=t.dateRange.start.toAbsoluteString(),a.endDate=t.dateRange.end.toAbsoluteString(),a.timezone=t.dateRange.start.timeZone,U.get(e,{params:a}).then(r=>r.data)}const wi=G(s.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"InfoOutlined");function Ee({data:e,isLoading:t,...a}){const n=(e==null?void 0:e.datasets[0].data)||[];return s.jsxs(Ts,{...a,className:"min-w-500 md:min-w-0 w-1/2",contentIsFlex:t,contentClassName:"max-h-[370px] overflow-y-auto compact-scrollbar",children:[t&&s.jsx(Ke,{}),n.map(r=>s.jsxs("div",{className:"mb-20 text-sm flex items-center justify-between gap-24",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx(Ni,{model:r.model,size:"w-42 h-42",className:"rounded flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",children:s.jsx(Ii,{model:r.model})}),s.jsx("div",{className:"text-xs text-muted",children:s.jsx(Ci,{model:r.model})})]})]}),s.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[s.jsx(gn,{className:"text-muted",size:"sm"}),s.jsx(d,{message:":count plays",values:{count:s.jsx(Be,{value:r.value})}})]})]},r.model.id)),!t&&!n.length?s.jsxs("div",{className:"flex items-center gap-8 text-muted",children:[s.jsx(wi,{size:"sm"}),s.jsx(d,{message:"No plays in selected timeframe."})]}):null]})}function Ni({model:e,size:t,className:a}){const{pathname:n}=ue(),i=n.includes("/admin")?`/admin/${e.model_type}s/${e.id}/insights`:`/backstage/${e.model_type}s/${e.id}/insights`;switch(e.model_type){case"artist":return s.jsx(Z,{to:i,children:s.jsx(kt,{artist:e,size:t,className:a})});case"album":return s.jsx(Z,{to:i,children:s.jsx(ss,{album:e,size:t,className:a})});case"track":return s.jsx(Z,{to:i,children:s.jsx(Ds,{track:e,size:t,className:a})});case"user":return s.jsx(bn,{user:e,size:t,className:a})}}function Ii({model:e}){switch(e.model_type){case"artist":return s.jsx(wt,{artist:e,target:"_blank"});case"album":return s.jsx(Ss,{album:e,target:"_blank"});case"track":return s.jsx($t,{track:e,target:"_blank"});case"user":return e.id?s.jsx(Wa,{user:e,target:"_blank"}):s.jsx(u.Fragment,{children:e.display_name})}}function Ci({model:e}){switch(e.model_type){case"artist":case"user":return null;case"album":case"track":return s.jsx(ts,{artists:e.artists,target:"_blank"})}}function Vs(e){const a="flex flex-col lg:flex-row lg:items-center overflow-x-auto gap-12 md:gap-24 mb-12 md:mb-24",n=e.model,r=e.dateRange;return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:a,children:[s.jsx(W,{metric:"plays",model:n,dateRange:r,children:({data:i})=>s.jsx(xi,{className:"flex-auto",title:s.jsx(d,{message:"Plays"}),hideLegend:!0,description:s.jsx(d,{message:":count total plays",values:{count:s.jsx(Be,{value:(i==null?void 0:i.report.plays.total)||0})}})})}),s.jsx(W,{metric:"devices",model:n,dateRange:r,children:s.jsx(et,{title:s.jsx(d,{message:"Top devices"})})})]}),s.jsxs("div",{className:a,children:[e.showTracks&&s.jsx(W,{metric:"tracks",model:n,dateRange:r,children:s.jsx(Ee,{title:s.jsx(d,{message:"Most played tracks"})})}),s.jsx(W,{metric:"users",model:n,dateRange:r,children:s.jsx(Ee,{title:s.jsx(d,{message:"Top listeners"})})})]}),e.showArtistsAndAlbums&&s.jsxs("div",{className:a,children:[s.jsx(W,{metric:"artists",model:n,dateRange:r,children:s.jsx(Ee,{title:s.jsx(d,{message:"Most played artists"})})}),s.jsx(W,{metric:"albums",model:n,dateRange:r,children:s.jsx(Ee,{title:s.jsx(d,{message:"Most played albums"})})})]}),s.jsxs("div",{className:a,children:[s.jsx(W,{metric:"locations",model:n,dateRange:r,children:s.jsx(ji,{className:"flex-auto w-1/2 lg:max-w-[740px]"})}),s.jsx(W,{metric:"platforms",model:n,dateRange:r,children:s.jsx(et,{className:"max-w-500",title:s.jsx(d,{message:"Top platforms"})})})]})]})}function W({children:e,metric:t,model:a,dateRange:n}){var x,m;const[r,i]=u.useState(!1),o=vi({metrics:[t],model:a,dateRange:n},{isEnabled:r}),l=typeof e=="function"?e(o):e,c=u.useRef(),f=u.useCallback(p=>{var h;if(p){const g=new IntersectionObserver(([b])=>{var v;b.isIntersecting&&(i(!0),(v=c.current)==null||v.disconnect(),c.current=void 0)},{threshold:.1});c.current=g,g.observe(p)}else c.current&&((h=c.current)==null||h.disconnect())},[]);return u.cloneElement(l,{data:(m=(x=o.data)==null?void 0:x.report)==null?void 0:m[t],isLoading:o.isLoading,contentRef:f})}function Rs({children:e,reportModel:t,title:a,isNested:n}){const[r,i]=u.useState(()=>Tt[2].getRangeValue());return s.jsxs(u.Fragment,{children:[s.jsx(Ga,{children:s.jsx(d,{message:"Insights"})}),s.jsxs("div",{className:"h-full flex flex-col",children:[!n&&s.jsx(yt,{className:"flex-shrink-0",color:"bg",darkModeColor:"bg"}),s.jsx("div",{className:"overflow-y-auto flex-auto bg-cover relative",children:s.jsxs("div",{className:"min-h-full p-12 md:p-24 overflow-x-hidden max-w-[1600px] mx-auto flex flex-col",children:[s.jsxs("div",{className:"flex-auto",children:[s.jsxs("div",{className:"md:flex items-center justify-between gap-24 h-48 mt-14 mb-38",children:[a||s.jsx(pe,{className:"max-w-320"}),s.jsx("div",{className:"flex-shrink-0 flex items-center justify-between gap-10 md:gap-24",children:s.jsx(li,{value:r,onChange:i})})]}),u.cloneElement(e,{dateRange:r,model:t})]}),!n&&s.jsx(vt,{})]})})]})]})}function zs({image:e,name:t,description:a}){return s.jsxs("div",{className:"flex items-center gap-10",children:[u.cloneElement(e,{size:"w-48 h-48",className:"rounded"}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-base whitespace-nowrap overflow-hidden overflow-ellipsis",children:["“",t,"“ ",s.jsx(d,{message:"insights"})]}),a&&s.jsx("div",{className:"text-muted text-sm",children:a})]})]})}function Ei({isNested:e}){const{artistId:t}=es(),{data:a}=Pt({loader:"artist"});return s.jsx(Rs,{reportModel:`artist=${t}`,title:(a==null?void 0:a.artist)&&s.jsx(zs,{image:s.jsx(kt,{artist:a.artist}),name:s.jsx(wt,{artist:a.artist})}),isNested:e,children:s.jsx(Vs,{showTracks:!0})})}function Ui({isNested:e}){const{albumId:t}=es(),{data:a}=Dt({loader:"album"});return s.jsx(Rs,{reportModel:`album=${t}`,title:(a==null?void 0:a.album)&&s.jsx(zs,{image:s.jsx(ss,{album:a.album}),name:s.jsx(Ss,{album:a.album}),description:s.jsx(ts,{artists:a.album.artists})}),isNested:e,children:s.jsx(Vs,{showTracks:!0})})}function _i({isNested:e}){const{trackId:t}=es(),{data:a}=Ct({loader:"track"});return s.jsx(Rs,{reportModel:`track=${t}`,title:(a==null?void 0:a.track)&&s.jsx(zs,{image:s.jsx(Ds,{track:a.track}),name:s.jsx($t,{track:a.track}),description:s.jsx(ts,{artists:a.track.artists})}),isNested:e,children:s.jsx(Vs,{})})}export{Cn as A,ra as B,Yn as C,Ln as D,Ui as E,Kn as F,ji as G,Li as H,Vs as I,Ei as J,Vi as K,xi as L,ar as M,pi as N,Or as O,et as P,Wt as Q,li as R,wi as S,Fi as U,zt as a,Vt as b,us as c,Tt as d,Ht as e,Et as f,Ot as g,$i as h,xe as i,er as j,tr as k,Fe as l,Te as m,_t as n,qt as o,zi as p,Mi as q,Yr as r,ia as s,ge as t,Ws as u,gi as v,Ai as w,_i as x,Ri as y,Ti as z};
//# sourceMappingURL=backstage-track-insights-61e089d1.js.map
