import{bx as F,j as e,as as M,O as ie,r as d,cT as oe,Q as ce,T as b,N as ue,C as le,cU as de,ax as C,ao as be,b8 as pe,Y as w,n as Q,a_ as fe,cV as me,cQ as ge,M as he,J as I,aZ as Y,u as _,bw as xe,b7 as ye,ay as D,x as je,y as ve,p as V,au as Se,B as Z,W as we,aC as ke,az as q,bR as T,m,cW as Ne,cR as Ee,cS as N}from"./main-96dd97cc.js";import{S as Ce,l as Le,B as O}from"./billing-redirect-message-8d62760c.js";import"./TaskAlt-43ef6839.js";function E({children:t}){const{isLoggedIn:s,isSubscribed:r}=F();return s?s&&r?e.jsx(M,{to:"/billing",replace:!0}):t||e.jsx(ie,{}):e.jsx(M,{to:"/register",replace:!0})}function R({children:t}){const[s,r]=t;return d.useEffect(()=>{oe("be.onboarding.selected")},[]),e.jsxs(d.Fragment,{children:[e.jsx(ce,{children:e.jsx(b,{message:"Checkout"})}),e.jsx(ue,{size:"sm",color:"transparent",className:"z-10 mb-20 md:mb-0",textColor:"text-main",logoColor:"dark",darkModeColor:"transparent",menuPosition:"checkout-page-navbar"}),e.jsxs("div",{className:"md:flex w-full mx-auto justify-between px-20 md:px-0 md:pt-128 md:max-w-950",children:[e.jsx("div",{className:"hidden md:block fixed right-0 top-0 w-1/2 h-full bg-alt shadow-[15px_0_30px_0_rgb(0_0_0_/_18%)]"}),e.jsxs("div",{className:"md:w-400 overflow-hidden",children:[s,e.jsx(le,{menu:"checkout-page-footer",className:"text-xs mt-50 text-muted overflow-x-auto"}),e.jsx("div",{className:"mt-40",children:e.jsx(de,{})})]}),e.jsx("div",{className:"hidden md:block w-384",children:e.jsx("div",{className:"relative z-10",children:r})})]})]})}const H=t=>`billing/products/${t}`;function _e(){var o;const{productId:t,priceId:s}=C(),r=be({queryKey:[H(t)],queryFn:()=>Re(t),placeholderData:pe,enabled:t!=null&&s!=null}),n=(o=r.data)==null?void 0:o.product,i=(n==null?void 0:n.prices.find(a=>a.id===parseInt(s)))||(n==null?void 0:n.prices[0]);return{status:r.status,product:n,price:i}}function Re(t){return w.get(H(t)).then(s=>s.data)}function P({showBillingLine:t=!0}){const{status:s,product:r,price:n}=_e();return s==="error"||s!=="pending"&&(!r||!n)?null:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl mb-30",children:e.jsx(b,{message:"Summary"})}),s==="pending"?e.jsx($e,{},"loading-skeleton"):e.jsx(Pe,{product:r,price:n,showBillingLine:t})]})}function Pe({product:t,price:s,showBillingLine:r}){return e.jsxs(Q.div,{children:[e.jsx("div",{className:"text-xl font-semibold mb-6",children:t.name}),t.description&&e.jsx("div",{className:"text-sm text-muted",children:t.description}),e.jsx(fe,{priceClassName:"font-bold text-4xl",periodClassName:"text-muted text-xs",variant:"separateLine",price:s,className:"mt-32"}),e.jsx(me,{product:t}),r&&e.jsxs("div",{className:"flex items-center justify-between gap-24 border-t pt-24 mt-32 font-medium",children:[e.jsx("div",{children:e.jsx(b,{message:"Billed today"})}),e.jsx("div",{children:e.jsx(ge,{value:s.amount,currency:s.currency})})]})]})}function $e(){return e.jsxs(Q.div,{...he,className:"max-w-180",children:[e.jsx(I,{className:"text-xl mb-6"}),e.jsx(I,{className:"text-sm"}),e.jsx(I,{className:"text-4xl mt-32"})]})}/*!
 * paypal-js v7.1.1 (2023-11-27T14:12:58.587Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ie(t,s){var r=document.querySelector('script[src="'.concat(t,'"]'));if(r===null)return null;var n=K(t,s),i=r.cloneNode();if(delete i.dataset.uidAuto,Object.keys(i.dataset).length!==Object.keys(n.dataset).length)return null;var o=!0;return Object.keys(i.dataset).forEach(function(a){i.dataset[a]!==n.dataset[a]&&(o=!1)}),o?r:null}function Be(t){var s=t.url,r=t.attributes,n=t.onSuccess,i=t.onError,o=K(s,r);o.onerror=i,o.onload=n,document.head.insertBefore(o,document.head.firstElementChild)}function Me(t){var s="https://www.paypal.com/sdk/js";t.sdkBaseUrl&&(s=t.sdkBaseUrl,delete t.sdkBaseUrl);var r=t,n=Object.keys(r).filter(function(a){return typeof r[a]<"u"&&r[a]!==null&&r[a]!==""}).reduce(function(a,u){var p=r[u].toString();return u=Fe(u),u.substring(0,4)==="data"||u==="crossorigin"?a.attributes[u]=p:a.queryParams[u]=p,a},{queryParams:{},attributes:{}}),i=n.queryParams,o=n.attributes;return i["merchant-id"]&&i["merchant-id"].indexOf(",")!==-1&&(o["data-merchant-id"]=i["merchant-id"],i["merchant-id"]="*"),{url:"".concat(s,"?").concat(De(i)),attributes:o}}function Fe(t){var s=function(r,n){return(n?"-":"")+r.toLowerCase()};return t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,s)}function De(t){var s="";return Object.keys(t).forEach(function(r){s.length!==0&&(s+="&"),s+=r+"="+t[r]}),s}function K(t,s){s===void 0&&(s={});var r=document.createElement("script");return r.src=t,Object.keys(s).forEach(function(n){r.setAttribute(n,s[n]),n==="data-csp-nonce"&&r.setAttribute("nonce",s["data-csp-nonce"])}),r}function qe(t,s){if(s===void 0&&(s=Promise),J(t,s),typeof document>"u")return s.resolve(null);var r=Me(t),n=r.url,i=r.attributes,o=i["data-namespace"]||"paypal",a=W(o);return Ie(n,i)&&a?s.resolve(a):Te({url:n,attributes:i},s).then(function(){var u=W(o);if(u)return u;throw new Error("The window.".concat(o," global variable is not available."))})}function Te(t,s){s===void 0&&(s=Promise),J(t,s);var r=t.url,n=t.attributes;if(typeof r!="string"||r.length===0)throw new Error("Invalid url.");if(typeof n<"u"&&typeof n!="object")throw new Error("Expected attributes to be an object.");return new s(function(i,o){if(typeof document>"u")return i();Be({url:r,attributes:n,onSuccess:function(){return i()},onError:function(){var a=new Error('The script "'.concat(r,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return o(a)}})})}function W(t){return window[t]}function J(t,s){if(typeof t!="object"||t===null)throw new Error("Expected an options object.");if(typeof s<"u"&&typeof s!="function")throw new Error("Expected PromisePonyfill to be a function.")}function Oe({productId:t,priceId:s}){const{data:r}=Y(),n=d.useRef(!1),i=d.useRef(!1),[o,a]=d.useState(!1),u=d.useRef(null),{base_url:p,billing:{stripe:{enable:y},paypal:{enable:g,public_key:l}}}=_();return d.useEffect(()=>{!g||!l||n.current||(qe({clientId:l,intent:"subscription",vault:!0,disableFunding:y?"card":void 0}).then(()=>{a(!0)}),n.current=!0)},[l,g,y]),d.useEffect(()=>{var S;if(!o||!((S=window.paypal)!=null&&S.Buttons)||!u.current||!(r!=null&&r.products.length)||!t||!s||i.current)return;const f=r.products.find(c=>c.id===parseInt(t)),j=f==null?void 0:f.prices.find(c=>c.id===parseInt(s));window.paypal.Buttons({style:{label:"pay"},createSubscription:(c,v)=>v.subscription.create({application_context:{shipping_preference:"NO_SHIPPING"},plan_id:j==null?void 0:j.paypal_id}),onApprove:(c,v)=>(v.redirect(`${p}/checkout/${t}/${s}/paypal/done?subscriptionId=${c.subscriptionID}&status=success`),Promise.resolve()),onError:c=>{location.href=`${p}/checkout/${t}/${s}/paypal/done?status=error`}}).render(u.current).then(()=>{i.current=!0})},[t,s,r,o,p]),{paypalElementRef:u,stripeIsEnabled:l!=null&&g}}function Ae({priceId:t}){F(),xe(),d.useRef(!1),ye();const{branding:{site_name:s},billing:{phonesub:{enable:r}}}=_();return{phonesub:{subscribeStart:async({phone:a})=>(await w.post("billing/phonesub/subscribe-start",{price_id:t,phone:a})).data,subscribeVerify:async({auth_code:a})=>(await w.post("billing/phonesub/subscribe-verify",{price_id:t,auth_code:a})).data,syncSubscriptionDetails:()=>w.post("billing/phonesub/sync-subscription-details",{price_id:t})},phonesubIsEnabled:r}}function B({title:t,message:s,type:r}){var i,o;r=r??"danger";const n={info:{title:"bg-primary text-white",body:"border-primary bg-primary-light dark:bg-primary-dark text-black dark:text-white"},danger:{title:"bg-danger text-white",body:"border-danger bg-danger-lighter dark:bg-danger-darker text-black dark:text-white"}};return e.jsxs("div",{role:"alert",className:"mb-32",children:[t&&e.jsx("div",{className:`${(i=n[r])==null?void 0:i.title} font-bold rounded-t px-8 py-4`,children:t}),e.jsx("div",{className:`${(o=n[r])==null?void 0:o.body} border border-t-0 rounded-b px-8 py-6`,children:e.jsx("p",{children:s})})]})}function Ve(t){const s=(t==null?void 0:t.length)??0,r=3;return t===void 0?"":t.substring(0,r)+t.substring(r,s-r).replace(/./g,".")+t.substring(s-r)}function We({priceId:t,type:s="subscription",submitLabel:r,verifyLabel:n,resendLabel:i,returnUrl:o}){const{phonesub:a,phonesubIsEnabled:u}=Ae({type:s,priceId:t}),[p,y]=d.useState(null),[g,l]=d.useState(!1),[f,j]=d.useState("start"),S=D(),{user:c}=F(),v=je({defaultValues:{phone:(c==null?void 0:c.phone)||""}}),X=d.useRef(null),ee=d.useRef(null),te=f=="verify"||f=="verified",se=f=="syncerror"||f=="expired",re=f=="start",ne=!u||a!=null,ae=async L=>{var h,k;if(a){l(!0);try{const x=await a[f!=="verify"?"subscribeStart":"subscribeVerify"](L);x.status=="verify"&&x.phone&&c&&(c.phone=x.phone),x.status=="verified"&&A(),x.status&&j(x.status),((h=x.error)==null?void 0:h.type)!=="validation_error"&&((k=x.error)!=null&&k.message)?y(x.error.message):y(null)}catch{}l(!1)}},A=(L=0)=>setTimeout(()=>{a.syncSubscriptionDetails().then(h=>{var k,$,x;(k=h==null?void 0:h.data)!=null&&k.message&&we(($=h==null?void 0:h.data)==null?void 0:$.message),S(o+"?status=success&subscriptionId="+(((x=h==null?void 0:h.data)==null?void 0:x.subscriptionId)??"null"))},h=>{L>15?j("syncerror"):A(L+1)})},1e3);return e.jsxs(ve,{form:v,onSubmit:ae,children:[f==="verify"&&e.jsxs("div",{children:[e.jsx(B,{title:e.jsx(b,{message:"Sending verification code"}),type:"info",message:e.jsx(b,{message:"Please enter verification code sent to your phone number: :phone",values:{phone:Ve(c==null?void 0:c.phone)}})}),e.jsx(V,{className:"mb-32",name:"auth_code",type:"text",label:e.jsx(b,{message:"Verification code"}),required:!0,inputRef:X})]}),f==="verified"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center flex-auto mb-8",children:e.jsx(Se,{isIndeterminate:!0,"aria-label":"Waiting for server response..."})}),e.jsx(B,{title:e.jsx(b,{message:"Verification successful"}),type:"info",message:e.jsx(b,{message:"Waiting for Subscription server response..."})})]}),f==="syncerror"&&e.jsx("div",{className:"text-danger mt-20",children:e.jsx(b,{message:"Something went wrong. Please try again later."})}),p&&!g&&e.jsx("div",{className:"text-danger mt-20",children:p}),re&&e.jsxs("div",{children:[e.jsx(B,{title:e.jsx(b,{message:"Enter phone number"}),type:"info",message:e.jsx(b,{message:"Please enter phone number you intend to use for phone payment"})}),e.jsx(V,{className:"mb-32",name:"phone",type:"text",label:e.jsx(b,{message:"Phone number"}),required:!0,inputRef:ee})]}),e.jsx(Z,{variant:"flat",color:"primary",size:"md",className:"w-full mt-40",type:"submit",disabled:g||!ne,children:te?n:se?i:r})]})}function z(){var S;const{productId:t,priceId:s,paymentMethodId:r}=C(),n=Y(),{paypalElementRef:i}=Oe({productId:t,priceId:s}),{base_url:o,billing:{stripe:a,phonesub:u,paypal:p}}=_(),y=D();if(n.isLoading)return e.jsx(ke,{screen:!0});const g=(S=n.data)==null?void 0:S.products.find(c=>c.id===parseInt(t)),l=g==null?void 0:g.prices.find(c=>c.id===parseInt(s));if(!g||!l||n.status==="error")return e.jsx(M,{to:"/pricing",replace:!0});const f=[{key:"phonesub",component:e.jsx(We,{productId:t,priceId:s,submitLabel:e.jsx(b,{message:"Send code"}),verifyLabel:e.jsx(b,{message:"Verify code"}),resendLabel:e.jsx(b,{message:"Resend code"}),type:"subscription",returnUrl:`/checkout/${t}/${s}/phonesub/done`}),enable:u.enable&&((l==null?void 0:l.paymentMethods)||[]).includes("phonesub")},{key:"stripe",component:e.jsx(Ce,{productId:t,priceId:s,submitLabel:e.jsx(b,{message:"Upgrade"}),type:"subscription",returnUrl:`${o}/checkout/${t}/${s}/stripe/done`}),enable:a.enable&&((l==null?void 0:l.paymentMethods)||[]).includes("stripe")},{key:"paypal",component:e.jsx("div",{ref:i}),enable:p.enable&&((l==null?void 0:l.paymentMethods)||[]).includes("paypal")},{key:"go-back",component:e.jsx(Z,{variant:"flat",color:"chip",size:"md",className:"w-full",type:"button",onClick:()=>{y("/pricing")},children:e.jsx(b,{message:"Go back"})}),enable:!0}];f.sort((c,v)=>c.key===r?-1:v.key===r?1:0);const j=f.filter(c=>c.enable);return e.jsxs(R,{children:[e.jsxs(d.Fragment,{children:[e.jsx("h1",{className:"mb-40 text-4xl",children:e.jsx(b,{message:"Checkout"})}),j.map((c,v)=>e.jsxs(d.Fragment,{children:[c.component,v<j.length-1&&e.jsx(ze,{})]},c.key)),e.jsx("div",{className:"mt-30 text-xs text-muted",children:e.jsx(b,{message:"You’ll be charged until you cancel your subscription. Previous charges won’t be refunded when you cancel unless it’s legally required. Your payment data is encrypted and secure. By subscribing your agree to our terms of service and privacy policy."})})]}),e.jsx(P,{})]})}function ze(){return e.jsx("div",{className:"relative my-20 text-center before:absolute before:left-0 before:top-1/2 before:h-1 before:w-full before:-translate-y-1/2 before:bg-divider",children:e.jsx("span",{className:"relative z-10 bg px-10 text-sm text-muted",children:e.jsx(b,{message:"or"})})})}function Ue(){const{invalidateBootstrapData:t}=q(),{productId:s,priceId:r}=C(),n=D(),{billing:{stripe_public_key:i}}=_(),[o]=T(),a=o.get("payment_intent_client_secret"),[u,p]=d.useState(),y=d.useRef();return d.useEffect(()=>{y.current||(Le(i).then(async g=>{if(!g||!a){p(U());return}g.retrievePaymentIntent(a).then(({paymentIntent:l})=>{(l==null?void 0:l.status)==="succeeded"&&Ge(l.id).then(()=>{t()}),p(U(l==null?void 0:l.status,s,r))})}),y.current=!0)},[i,a,r,s,t]),a?e.jsxs(R,{children:[e.jsx(O,{config:u}),e.jsx(P,{showBillingLine:!1})]}):(n("/"),null)}function U(t,s,r){switch(t){case"succeeded":return{message:m("Subscription successful!"),status:"success",buttonLabel:m("Return to site"),link:"/billing"};case"processing":return{message:m("Payment processing. We'll update you when payment is received."),status:"success",buttonLabel:m("Return to site"),link:"/billing"};case"requires_payment_method":return{message:m("Payment failed. Please try another payment method."),status:"error",buttonLabel:m("Go back"),link:G(s,r)};default:return{message:m("Something went wrong"),status:"error",buttonLabel:m("Go back"),link:G(s,r)}}}function G(t,s){return t&&s?`/checkout/${t}/${s}`:"/"}function Ge(t){return w.post("billing/stripe/store-subscription-details-locally",{payment_intent_id:t})}function Qe(){const{invalidateBootstrapData:t}=q(),{productId:s,priceId:r}=C(),[n]=T(),[i,o]=d.useState();return d.useEffect(()=>{const a=n.get("subscriptionId"),u=n.get("status");o(Ye(u,s,r)),a&&u==="success"&&He(a).then(()=>{t()})},[r,s,n,t]),e.jsxs(R,{children:[e.jsx(O,{config:i}),e.jsx(P,{showBillingLine:!1})]})}function Ye(t,s,r){switch(t){case"success":return{message:m("Subscription successful!"),status:"success",buttonLabel:m("Return to site"),link:"/billing"};default:return{message:m("Something went wrong. Please try again."),status:"error",buttonLabel:m("Go back"),link:Ze(s,r)}}}function Ze(t,s){return t&&s?`/checkout/${t}/${s}`:"/"}function He(t){return w.post("billing/paypal/store-subscription-details-locally",{paypal_subscription_id:t})}function Ke(){const{invalidateBootstrapData:t}=q(),{productId:s,priceId:r}=C(),[n]=T(),[i,o]=d.useState(),[a,u]=Ne("redirectedFrom");return d.useEffect(()=>{n.get("subscriptionId");const p=n.get("status");o(Je(p,s,r,a))},[r,s,n,t]),e.jsxs(R,{children:[e.jsx(O,{config:i}),e.jsx(P,{showBillingLine:!1})]})}function Je(t,s,r,n){switch(t){case"success":return{message:m("Subscription successful!"),status:"success",buttonLabel:m("Return to site"),link:n??"/"};default:return{message:m("Something went wrong. Please try again."),status:"error",buttonLabel:m("Go back"),link:Xe(s,r)}}}function Xe(t,s){return t&&s?`/checkout/${t}/${s}`:"/"}function rt(){return e.jsxs(Ee,{children:[e.jsx(N,{path:":productId/:priceId",element:e.jsx(E,{children:e.jsx(z,{})})}),e.jsx(N,{path:":productId/:priceId/:paymentMethodId",element:e.jsx(E,{children:e.jsx(z,{})})}),e.jsx(N,{path:":productId/:priceId/stripe/done",element:e.jsx(E,{children:e.jsx(Ue,{})})}),e.jsx(N,{path:":productId/:priceId/paypal/done",element:e.jsx(E,{children:e.jsx(Qe,{})})}),e.jsx(N,{path:":productId/:priceId/phonesub/done",element:e.jsx(E,{children:e.jsx(Ke,{})})})]})}export{rt as default};
//# sourceMappingURL=checkout-routes-4cd59be4.js.map
